<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok AI - Canlı API Akışı</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #0a0a0a; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        .phone-frame {
            width: 360px; height: 720px; background: #000; border: 10px solid #1f1f1f;
            border-radius: 45px; position: relative; overflow: hidden; box-shadow: 0 0 40px rgba(0,0,0,1);
        }
        #videoFeed { height: 100%; overflow-y: scroll; scroll-snap-type: y mandatory; scrollbar-width: none; }
        #videoFeed::-webkit-scrollbar { display: none; }
        .video-item { height: 100%; width: 100%; scroll-snap-align: start; position: relative; background: #000; }
        iframe { width: 100%; height: 100%; pointer-events: none; border: none; }
        .overlay { position: absolute; bottom: 85px; left: 15px; right: 75px; z-index: 10; pointer-events: none; }
        .side-bar { position: absolute; right: 12px; bottom: 110px; display: flex; flex-direction: column; align-items: center; gap: 22px; z-index: 20; }
        .disc { width: 42px; height: 42px; border-radius: 50%; background: #111; border: 5px solid #222; animation: spin 4s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; z-index: 100; }
    </style>
</head>
<body>

    <div id="loading" class="loader"><i class="fas fa-circle-notch fa-spin text-4xl"></i></div>

    <div class="phone-frame">
        <div id="videoFeed"></div>
        <nav class="absolute bottom-0 w-full bg-gradient-to-t from-black py-5 flex justify-around items-center z-50">
            <i class="fas fa-home text-white"></i>
            <i class="fas fa-compass text-zinc-500"></i>
            <div class="bg-white text-black px-3 rounded font-bold">+</div>
            <i class="fas fa-comment text-zinc-500"></i>
            <i class="fas fa-user text-zinc-500"></i>
        </nav>
    </div>

    <script>
        const API_KEY = 'AIzaSyDkaygARzpXfIXlozjyppLdXsPoE-mq1gg';
        const feed = document.getElementById('videoFeed');
        const loading = document.getElementById('loading');
        let nextToken = '';

        // API'DEN CANLI VİDEO ÇEKME
        async function fetchVideos() {
            try {
                // Türkçe, Dikey (Shorts) ve En Popüler videoları arar
                const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=shorts+türkçe+komedi+akım&type=video&videoDuration=short&relevanceLanguage=tr&key=${API_KEY}&pageToken=${nextToken}`;
                
                const response = await fetch(url);
                const data = await response.json();
                nextToken = data.nextPageToken || '';
                
                data.items.forEach(item => {
                    renderVideo(item.id.videoId, item.snippet.channelTitle, item.snippet.title);
                });
                loading.style.display = 'none';
                setupObserver();
            } catch (error) {
                console.error("API Hatası:", error);
                alert("API Kotası dolmuş olabilir veya anahtar geçersiz.");
            }
        }

        function renderVideo(id, user, desc) {
            const card = document.createElement('div');
            card.className = 'video-item';
            card.innerHTML = `
                <div class="w-full h-full relative">
                    <iframe id="player-${id}" src="https://www.youtube-nocookie.com/embed/${id}?enablejsapi=1&autoplay=0&controls=0&loop=1&playlist=${id}" allow="autoplay"></iframe>
                    <div class="overlay">
                        <div class="bg-red-600/80 text-[10px] px-2 py-0.5 rounded inline-block mb-1">CANLI AKIŞ</div>
                        <h3 class="font-bold text-white">@${user.replace(/\s+/g, '').toLowerCase()}</h3>
                        <p class="text-xs text-white/90 line-clamp-2">${desc}</p>
                    </div>
                    <div class="side-bar">
                        <div class="w-11 h-11 rounded-full border-2 border-white overflow-hidden bg-zinc-800">
                            <img src="https://ui-avatars.com/api/?name=${user}&background=random">
                        </div>
                        <div class="flex flex-col items-center"><i class="fas fa-heart text-3xl text-white"></i><span class="text-[10px] text-white">Beğen</span></div>
                        <div class="flex flex-col items-center"><i class="fas fa-comment-dots text-3xl text-white"></i><span class="text-[10px] text-white">Yorum</span></div>
                        <div class="disc"></div>
                    </div>
                </div>
            `;
            feed.appendChild(card);
        }

        // AKILLI OYNATMA SİSTEMİ
        let obs;
        function setupObserver() {
            if (obs) obs.disconnect();
            obs = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const iframe = entry.target.querySelector('iframe');
                    if (entry.isIntersecting) {
                        iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
                    } else {
                        iframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
                    }
                });
            }, { threshold: 0.8 });
            document.querySelectorAll('.video-item').forEach(v => obs.observe(v));
        }

        // SONSUZ KAYDIRMA: Sona gelince API'den yeni sayfa çek
        feed.addEventListener('scroll', () => {
            if (feed.scrollTop + feed.clientHeight >= feed.scrollHeight - 500) {
                fetchVideos();
            }
        });

        // İLK ÇALIŞTIRMA
        fetchVideos();
    </script>
</body>
</html>
