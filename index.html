<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonsuz Algoritma Reels</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background-color: #000; display: flex; justify-content: center; height: 100vh; overflow: hidden; font-family: sans-serif; }
        
        .reels-wrapper { width: 100%; max-width: 420px; height: 100vh; position: relative; background: #000; border: 1px solid #222; }
        .reels-container { width: 100%; height: 100%; overflow-y: scroll; scroll-snap-type: y mandatory; scrollbar-width: none; }
        .reels-container::-webkit-scrollbar { display: none; }

        .reel { width: 100%; height: 100%; scroll-snap-align: start; position: relative; background: #000; display: flex; align-items: center; }
        
        iframe { width: 100%; height: 100%; border: none; transform: scale(1.3); } /* Dikey görünüm zoom */

        /* Arayüz */
        .side-bar { position: absolute; right: 12px; bottom: 80px; display: flex; flex-direction: column; gap: 20px; z-index: 20; }
        .action-btn { display: flex; flex-direction: column; align-items: center; color: white; cursor: pointer; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .action-btn i { font-size: 28px; margin-bottom: 5px; }
        
        .video-info { position: absolute; bottom: 30px; left: 15px; color: white; z-index: 10; width: 75%; }
        .video-info h3 { font-size: 15px; margin-bottom: 5px; color: #fff; }
        .video-info p { font-size: 13px; opacity: 0.9; }

        #overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; cursor: pointer; }
    </style>
</head>
<body>

<div class="reels-wrapper">
    <div id="overlay" onclick="startEngine()">
        <i class="fas fa-bolt" style="font-size: 50px; color: #f1c40f; margin-bottom: 15px;"></i>
        <h2>Algoritmayı Başlat</h2>
        <p style="margin-top: 10px; opacity: 0.7;">Sonsuz Türkçe Shorts</p>
    </div>
    <div class="reels-container" id="reels-content"></div>
</div>

<script>
    const API_KEY = 'AIzaSyDkaygARzpXfIXlozjyppLdXsPoE-mq1gg';
    const container = document.getElementById('reels-content');
    let nextPageToken = '';
    let isLoading = false;

    // Algoritma Kelimeleri (Rastgele Türkçe içerikler için)
    const keywords = ["shorts türkçe", "komik videolar", "günlük vlog", "yemek tarifleri", "teknoloji inceleme"];

    async function fetchShorts() {
        if (isLoading) return;
        isLoading = true;

        const randomKey = keywords[Math.floor(Math.random() * keywords.length)];
        const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=5&q=${encodeURIComponent(randomKey)}&type=video&videoDuration=short&relevanceLanguage=tr&pageToken=${nextPageToken}&key=${API_KEY}`;

        try {
            const response = await fetch(url);
            const data = await response.json();
            nextPageToken = data.nextPageToken;

            data.items.forEach((item, index) => {
                const vId = item.id.videoId;
                const reel = document.createElement('div');
                reel.className = 'reel';
                reel.innerHTML = `
                    <iframe id="player-${vId}" src="https://www.youtube.com/embed/${vId}?enablejsapi=1&autoplay=0&controls=0&loop=1&playlist=${vId}&modestbranding=1&rel=0" allow="autoplay"></iframe>
                    <div class="side-bar">
                        <div class="action-btn" onclick="this.style.color='red'"><i class="fas fa-heart"></i><span>Beğen</span></div>
                        <div class="action-btn" onclick="this.style.color='#f1c40f'"><i class="fas fa-bookmark"></i><span>Kaydet</span></div>
                        <div class="action-btn"><i class="fas fa-share"></i><span>Paylaş</span></div>
                    </div>
                    <div class="video-info">
                        <h3>@${item.snippet.channelTitle}</h3>
                        <p>${item.snippet.title}</p>
                    </div>
                `;
                container.appendChild(reel);
                observer.observe(reel);
            });
            isLoading = false;
        } catch (error) {
            console.error("Algoritma hatası:", error);
            isLoading = false;
        }
    }

    // İzleyici: Videoları oynat/durdur ve sonuna gelince yenilerini yükle
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            const iframe = entry.target.querySelector('iframe');
            if (entry.isIntersecting) {
                // Ekrana gireni oynat
                iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
                
                // Eğer listenin sonuna yaklaştıysak yeni videolar çek (Sonsuz Kaydırma)
                if (entry.target === container.lastElementChild) {
                    fetchShorts();
                }
            } else {
                // Ekrandan çıkanı durdur
                iframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
            }
        });
    }, { threshold: 0.7 });

    function startEngine() {
        document.getElementById('overlay').style.display = 'none';
        fetchShorts();
    }
</script>

</body>
</html>
