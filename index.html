<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeliÅŸmiÅŸ Shorts MekanizmasÄ±</title>
    <style>
        body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: sans-serif; }
        
        /* Ana Ã‡erÃ§eve */
        .reels-wrapper { 
            width: 100%; max-width: 400px; height: 95vh; 
            border-radius: 30px; border: 4px solid #1a1a1a;
            position: relative; overflow: hidden;
        }

        /* KaydÄ±rma KonteynÄ±rÄ± */
        .reels-container {
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory; /* MÄ±knatÄ±s etkisi */
            scroll-behavior: smooth;
            -ms-overflow-style: none;  /* IE/Edge scrollbar gizle */
            scrollbar-width: none;     /* Firefox scrollbar gizle */
        }
        .reels-container::-webkit-scrollbar { display: none; } /* Chrome/Safari scrollbar gizle */

        /* Video KartÄ± */
        .video-card {
            height: 100%;
            width: 100%;
            scroll-snap-align: start; /* Her video baÅŸlangÄ±ca yapÄ±ÅŸÄ±r */
            scroll-snap-stop: always; /* KaydÄ±rÄ±rken videolarÄ± atlamaz */
            position: relative;
            background: #000;
        }

        iframe { width: 100%; height: 100%; pointer-events: none; transform: scale(1.1); }

        /* EtkileÅŸim KatmanlarÄ± */
        .click-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; }
        .side-bar { position: absolute; right: 15px; bottom: 100px; z-index: 100; display: flex; flex-direction: column; gap: 20px; }
        .action-btn { background: rgba(0,0,0,0.4); border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(5px); }
    </style>
</head>
<body>

<div class="reels-wrapper">
    <div class="reels-container" id="reelsContainer"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
    const videoData = ['znv__YAlrTQ', 'dj7QJ0-VIHc', 'fkDpX8UXHN4', 'lB6IgV1kapU', 'XHYVGwXC4Tc'];
    const players = {};

    function onYouTubeIframeAPIReady() {
        const container = document.getElementById('reelsContainer');
        
        videoData.forEach((id, index) => {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.setAttribute('data-id', id);
            card.innerHTML = `
                <div class="click-layer" onclick="handleTap('${id}')"></div>
                <div id="player-${id}"></div>
                <div class="side-bar">
                    <div class="action-btn" onclick="alert('BeÄŸenildi!')">â¤ï¸</div>
                    <div class="action-btn" onclick="alert('Yorum aÃ§Ä±ldÄ±!')">ğŸ’¬</div>
                </div>
            `;
            container.appendChild(card);

            players[id] = new YT.Player(`player-${id}`, {
                videoId: id,
                playerVars: { 'autoplay': 0, 'controls': 0, 'loop': 1, 'playlist': id, 'mute': 1 },
                events: {
                    'onReady': (e) => { if(index === 0) e.target.playVideo(); }
                }
            });
        });

        // GELÄ°ÅMÄ°Å KAYDIRMA MEKANÄ°ZMASI (Intersection Observer)
        const observerOptions = {
            root: container,
            threshold: 0.8 // Videonun %80'i gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nde tetikle
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const vId = entry.target.getAttribute('data-id');
                if (entry.isIntersecting) {
                    // Ekrana giren videoyu oynat ve sesini aÃ§
                    players[vId].playVideo();
                    players[vId].unMute();
                    console.log("OynatÄ±lÄ±yor: " + vId);
                } else {
                    // Ekrandan Ã§Ä±kan videoyu durdur
                    players[vId].pauseVideo();
                }
            });
        }, observerOptions);

        // Her kartÄ± izlemeye al
        document.querySelectorAll('.video-card').forEach(card => observer.observe(card));
    }

    function handleTap(id) {
        const state = players[id].getPlayerState();
        if (state === 1) players[id].pauseVideo();
        else players[id].playVideo();
    }
</script>
</body>
</html>
