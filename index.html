<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>KOALA KOMBAT | PRO TAPPER</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        :root { --main-yellow: #f5bb5f; --dark-card: #1c1f24; --border: #2d333b; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: #000; color: #fff; overflow: hidden; height: 100vh; position: fixed; width: 100%; }

        /* Sayfa YapÄ±sÄ± */
        .page { display: none; height: 100vh; padding: 15px 15px 120px; overflow-y: auto; }
        .page.active { display: block; }

        /* GeliÅŸmiÅŸ Koala Butonu */
        .koala-circle {
            position: relative; width: 280px; height: 280px; margin: 10px auto;
            border-radius: 50%; background: radial-gradient(circle, #444 0%, #000 100%);
            display: flex; align-items: center; justify-content: center;
            border: 8px solid #2d333b; transition: transform 0.05s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 60px rgba(245, 187, 95, 0.1); z-index: 10;
        }
        .koala-circle img { width: 90%; height: 90%; border-radius: 50%; object-fit: cover; pointer-events: none; }
        .koala-circle:active { transform: scale(0.92); }

        /* Kombo SayacÄ± */
        .combo-badge { position: absolute; top: -10px; right: -10px; background: red; color: white; padding: 5px 12px; border-radius: 20px; font-weight: 900; font-size: 14px; display: none; border: 2px solid white; animation: shake 0.5s infinite; }
        @keyframes shake { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }

        /* Bar TasarÄ±mlarÄ± */
        .bar-container { width: 100%; height: 12px; background: #111; border-radius: 10px; border: 1px solid var(--border); overflow: hidden; }
        .bar-fill-orange { height: 100%; background: linear-gradient(90deg, #f5bb5f, #ff8c00); transition: width 0.2s; }

        /* Navigasyon */
        nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 90px; background: #0d0d0d; border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; padding-bottom: 20px; z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #555; font-size: 10px; font-weight: bold; }
        .nav-item.active { color: #fff; }

        /* Upgrade KartlarÄ± */
        .upgrade-card { background: var(--dark-card); border: 1px solid var(--border); border-radius: 20px; padding: 15px; margin-bottom: 10px; transition: 0.3s; }
        .upgrade-card:active { background: #2d333b; }

        /* Tap Efekti */
        .tap-pop { position: absolute; color: white; font-size: 35px; font-weight: 900; pointer-events: none; animation: popUp 0.8s forwards; z-index: 100; }
        @keyframes popUp { 0% { opacity: 1; transform: scale(0.5) translateY(0); } 100% { opacity: 0; transform: scale(1.2) translateY(-150px); } }
    </style>
</head>
<body>

    <div id="p-home" class="page active">
        <div class="grid grid-cols-3 gap-2 mb-4">
            <div class="stat-card bg-[#1c1f24] rounded-xl p-2 text-center border border-zinc-800">
                <p class="text-[8px] text-zinc-500 font-bold uppercase">Multi-Tap</p>
                <p class="text-xs font-black text-yellow-400" id="ui-multi">x1</p>
            </div>
            <div class="stat-card bg-[#1c1f24] rounded-xl p-2 text-center border border-zinc-800">
                <p class="text-[8px] text-zinc-500 font-bold uppercase">Profit/H</p>
                <p class="text-xs font-black text-green-400" id="ui-pps">0</p>
            </div>
            <div class="stat-card bg-[#1c1f24] rounded-xl p-2 text-center border border-zinc-800">
                <p class="text-[8px] text-zinc-500 font-bold uppercase">Limit</p>
                <p class="text-xs font-black text-blue-400" id="ui-max-energy">1000</p>
            </div>
        </div>

        <div class="flex items-center justify-center gap-3 my-6">
            <img src="https://cryptologos.cc/logos/tether-usdt-logo.png" class="w-10 h-10">
            <h1 id="ui-bal" class="text-5xl font-black italic">0</h1>
        </div>

        <div class="koala-circle mx-auto" id="tap-btn">
            <div id="combo-ui" class="combo-badge">COMBO x2</div>
            <img src="coinkoala.jpg" alt="Koala">
        </div>

        <div class="mt-10 px-2">
            <div class="flex justify-between items-center mb-2">
                <div class="flex items-center gap-1 font-black text-2xl">
                    <i class="fa-solid fa-bolt text-yellow-400"></i>
                    <span id="ui-energy">1000</span>
                </div>
                <div class="flex gap-2">
                    <button onclick="nav('boost')" class="bg-zinc-800 text-xs px-3 py-1 rounded-lg border border-zinc-700 font-bold">ðŸš€ BOOST</button>
                </div>
            </div>
            <div class="bar-container"><div id="energy-bar" class="bar-fill-orange"></div></div>
        </div>
    </div>

    <div id="p-boost" class="page">
        <h1 class="text-2xl font-black mb-6 italic">GELÄ°ÅžTÄ°RMELER (TAP TO EARN)</h1>
        
        <div class="upgrade-card flex justify-between items-center" onclick="upgradeMultitap()">
            <div>
                <h3 class="font-bold text-lg">Multi-Tap</h3>
                <p class="text-xs text-zinc-500">Her tÄ±kta +1 coin fazla kazan.</p>
                <p class="text-sm font-black text-yellow-500 mt-1" id="cost-multi">500 ðŸª™</p>
            </div>
            <i class="fa-solid fa-hand-pointer text-2xl text-zinc-600"></i>
        </div>

        <div class="upgrade-card flex justify-between items-center" onclick="upgradeEnergy()">
            <div>
                <h3 class="font-bold text-lg">Energy Limit</h3>
                <p class="text-xs text-zinc-500">Maksimum enerji kapasitesini +500 artÄ±r.</p>
                <p class="text-sm font-black text-blue-500 mt-1" id="cost-energy">1,000 ðŸª™</p>
            </div>
            <i class="fa-solid fa-battery-full text-2xl text-zinc-600"></i>
        </div>
    </div>

    <nav>
        <div class="nav-item active" onclick="nav('home', this)"><i class="fa-solid fa-house"></i>GiriÅŸ</div>
        <div class="nav-item" onclick="nav('boost', this)"><i class="fa-solid fa-rocket"></i>GeliÅŸtir</div>
        <div class="nav-item" onclick="tg.showAlert('YakÄ±nda!')"><i class="fa-solid fa-users"></i>ArkadaÅŸlar</div>
        <div class="nav-item" onclick="tg.showAlert('YakÄ±nda!')"><i class="fa-solid fa-parachute-box"></i>Airdrop</div>
    </nav>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // Oyun DeÄŸiÅŸkenleri
    let user = {
        bal: 0,
        pps: 0,
        energy: 1000,
        maxEnergy: 1000,
        multiTap: 1,
        lvlMulti: 1,
        lvlEnergy: 1
    };

    let comboCount = 0;
    let lastTapTime = 0;

    function nav(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('p-' + id).classList.add('active');
        if(el) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }
        tg.HapticFeedback.impactOccurred('light');
    }

    // --- GELÄ°ÅžMÄ°Åž TIKLAMA SÄ°STEMÄ° ---
    document.getElementById('tap-btn').addEventListener('touchstart', (e) => {
        e.preventDefault();
        
        // Enerji KontrolÃ¼
        if(user.energy < user.multiTap) {
            tg.HapticFeedback.notificationOccurred('error');
            return;
        }

        const now = Date.now();
        // Kombo Sistemi: 300ms iÃ§inde ardÄ±ÅŸÄ±k tÄ±klar kombo yapar
        if(now - lastTapTime < 300) {
            comboCount++;
        } else {
            comboCount = 0;
        }
        lastTapTime = now;

        // KazanÃ§ Hesaplama (Kombo bonusu x2)
        let isCombo = comboCount > 10;
        let gain = isCombo ? user.multiTap * 2 : user.multiTap;
        
        user.bal += gain;
        user.energy -= user.multiTap;

        // UI GÃ¼ncelleme
        if(isCombo) document.getElementById('combo-ui').style.display = 'block';
        else document.getElementById('combo-ui').style.display = 'none';

        render();

        // SayÄ± Efekti
        const touch = e.touches[0];
        const p = document.createElement('div');
        p.className = 'tap-pop';
        p.style.color = isCombo ? '#ff4545' : 'white';
        p.innerText = `+${gain}`;
        p.style.left = touch.pageX + 'px';
        p.style.top = touch.pageY + 'px';
        document.body.appendChild(p);
        setTimeout(() => p.remove(), 800);

        tg.HapticFeedback.impactOccurred(isCombo ? 'heavy' : 'medium');
    });

    // --- UPGRADE FONKSÄ°YONLARI ---
    function upgradeMultitap() {
        let cost = user.lvlMulti * 500;
        if(user.bal >= cost) {
            user.bal -= cost;
            user.multiTap += 1;
            user.lvlMulti += 1;
            tg.showAlert("Multi-Tap YÃ¼kseltildi!");
            render();
        } else {
            tg.showAlert("Yetersiz Coin!");
        }
    }

    function upgradeEnergy() {
        let cost = user.lvlEnergy * 1000;
        if(user.bal >= cost) {
            user.bal -= cost;
            user.maxEnergy += 500;
            user.energy = user.maxEnergy;
            user.lvlEnergy += 1;
            tg.showAlert("Enerji Limiti ArtÄ±rÄ±ldÄ±!");
            render();
        } else {
            tg.showAlert("Yetersiz Coin!");
        }
    }

    // --- DÃ–NGÃœLER ---
    setInterval(() => {
        // Otomatik Enerji Dolumu
        if(user.energy < user.maxEnergy) {
            user.energy = Math.min(user.maxEnergy, user.energy + 3);
        }
        // Saatlik KÃ¢r
        if(user.pps > 0) user.bal += (user.pps / 3600);
        render();
    }, 1000);

    function render() {
        document.getElementById('ui-bal').innerText = Math.floor(user.bal).toLocaleString();
        document.getElementById('ui-energy').innerText = user.energy;
        document.getElementById('ui-multi').innerText = "x" + user.multiTap;
        document.getElementById('ui-max-energy').innerText = user.maxEnergy;
        document.getElementById('ui-pps').innerText = "+" + user.pps;
        
        document.getElementById('energy-bar').style.width = (user.energy / user.maxEnergy * 100) + "%";
        
        // Market FiyatlarÄ±
        document.getElementById('cost-multi').innerText = (user.lvlMulti * 500).toLocaleString() + " ðŸª™";
        document.getElementById('cost-energy').innerText = (user.lvlEnergy * 1000).toLocaleString() + " ðŸª™";
    }

    window.onload = render;
</script>
</body>
</html>
