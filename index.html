<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chalpus Game Store</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Tailwind CSS for rapid styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        #access-denied {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
            padding: 20px;
        }
        #main-content {
            display: block;
        }
        .banner-wrapper {
            position: relative;
            width: 100%;
            overflow: hidden;
        }
        .banner-container {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            gap: 12px;
            padding-bottom: 10px;
            scroll-behavior: smooth;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .banner-container::-webkit-scrollbar { display: none; }
        .banner-card {
            min-width: 90%;
            scroll-snap-align: center;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            height: 180px;
            flex-shrink: 0;
        }
        .glass-header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .btn-start {
            background-color: #00bad4;
            transition: all 0.2s;
        }
        .btn-start:active {
            transform: scale(0.95);
            opacity: 0.8;
        }
        .dot-indicator {
            width: 6px;
            height: 6px;
            background: #d1d5db;
            border-radius: 50%;
            transition: all 0.3s;
        }
        .dot-active {
            background: #00bad4;
            width: 16px;
            border-radius: 10px;
        }
    </style>
</head>
<body class="p-4">

    <!-- Access Denied Screen -->
    <div id="access-denied">
        <div class="bg-gray-100 p-8 rounded-full mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m0 0v3m0-3h3m-3 0H9m12-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        </div>
        <h2 class="text-2xl font-bold text-gray-800 mb-2">EriÅŸim Engellendi</h2>
        <p class="text-gray-500 mb-6">Bu uygulama sadece Telegram Ã¼zerinden kullanÄ±labilir.</p>
        <a href="https://t.me/your_bot_username" class="bg-cyan-500 text-white px-8 py-3 rounded-2xl font-bold shadow-lg shadow-cyan-200">Botu AÃ§</a>
    </div>

    <!-- Main App Content -->
    <div id="main-content">
        <!-- Header Area -->
        <div class="glass-header py-2 mb-4 flex justify-between items-center">
            <div>
                <h1 id="welcome-text" class="text-lg font-bold text-gray-800">Merhaba!</h1>
            </div>
            <div class="flex gap-2">
                <button class="p-2 bg-gray-100 rounded-full relative">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                    </svg>
                    <span class="absolute top-1 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
                </button>
                <div class="flex items-center gap-1 bg-gray-100 px-2 py-1 rounded-lg border">
                    <span class="text-xl">ðŸ‡¹ðŸ‡·</span>
                </div>
            </div>
        </div>

        <!-- Featured Banner (Carousel) -->
        <div class="banner-wrapper">
            <div class="banner-container mb-2" id="banner-list">
                <!-- Banners will be loaded here -->
            </div>
        </div>
        
        <!-- Dots for Banner -->
        <div class="flex justify-center gap-1 mb-6" id="banner-dots">
            <!-- Dots will be loaded here -->
        </div>

        <!-- Section Title -->
        <div class="mb-4 flex items-center justify-between">
            <h2 class="text-xl font-bold text-gray-800">Yeni Oyunlar</h2>
            <span class="text-cyan-500 text-sm font-semibold">TÃ¼mÃ¼ &rsaquo;</span>
        </div>

        <!-- Games List -->
        <div id="game-list" class="space-y-4 pb-10">
            <!-- Loading State -->
            <div class="animate-pulse flex space-x-4">
                <div class="rounded-2xl bg-gray-200 h-16 w-16"></div>
                <div class="flex-1 space-y-3 py-1">
                    <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                    <div class="h-3 bg-gray-200 rounded w-1/2"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBbA61N0ztsdRxEjwMUS0YKXXfXV4DMEVQ",
            authDomain: "playcentr-67140.firebaseapp.com",
            projectId: "playcentr-67140",
            storageBucket: "playcentr-67140.firebasestorage.app",
            messagingSenderId: "306761978239",
            appId: "1:306761978239:web:17d4e797da09fa0b49ca4a"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const tg = window.Telegram.WebApp;
        const user = tg.initDataUnsafe?.user;

        const welcomeText = document.getElementById('welcome-text');
        const gameList = document.getElementById('game-list');
        const bannerList = document.getElementById('banner-list');
        const bannerDots = document.getElementById('banner-dots');
        const mainContent = document.getElementById('main-content');
        const accessDenied = document.getElementById('access-denied');

        let autoSlideInterval;

        // Security Check: Only allow Telegram WebApp environment
        function checkPlatform() {
            // Check if Telegram platform info exists
            if (!tg.platform || tg.platform === 'unknown') {
                mainContent.style.display = 'none';
                accessDenied.style.display = 'flex';
                return false;
            }
            return true;
        }

        async function initApp() {
            if (!checkPlatform()) return;

            tg.expand();
            
            if (user) {
                welcomeText.innerText = `Merhaba! ${user.first_name}`;
                try {
                    await setDoc(doc(db, "users", user.id.toString()), {
                        first_name: user.first_name,
                        username: user.username || "",
                        last_active: serverTimestamp(),
                        isAdmin: user.id.toString() === "8392479231"
                    }, { merge: true });
                } catch (e) { console.error(e); }
            } else {
                welcomeText.innerText = "Merhaba! Misafir";
            }
            loadContent();
        }

        async function loadContent() {
            try {
                const gamesSnapshot = await getDocs(collection(db, "apps"));
                let gamesData = [];
                gamesSnapshot.forEach((doc) => { gamesData.push(doc.data()); });

                if (gamesData.length === 0) {
                    gamesData = [
                        { name: "CowHub", description: "Moo ~ Moo ~ Moo ~", icon: "https://api.dicebear.com/7.x/bottts/svg?seed=cow", link: "https://t.me/cowhub_bot", banner: "https://picsum.photos/seed/cow/800/400" },
                        { name: "Egg Factory", description: "Daha fazla yumurta alÄ±n.", icon: "https://api.dicebear.com/7.x/bottts/svg?seed=egg", link: "#", banner: "https://picsum.photos/seed/egg/800/400" },
                        { name: "Banana Town", description: "Kazanmak iÃ§in dokunun.", icon: "https://api.dicebear.com/7.x/bottts/svg?seed=banana", link: "#", banner: "https://picsum.photos/seed/banana/800/400" },
                        { name: "Plant TON", description: "Ã‡iftÃ§iliÄŸi eÄŸlenceli hale getirin.", icon: "https://api.dicebear.com/7.x/bottts/svg?seed=plant", link: "#" },
                        { name: "Dogs", description: "PopÃ¼ler meme coin oyunu.", icon: "https://api.dicebear.com/7.x/bottts/svg?seed=dog", link: "#" },
                        { name: "Getgems", description: "NFT dÃ¼nyasÄ±na girin.", icon: "https://api.dicebear.com/7.x/bottts/svg?seed=gem", link: "#" },
                        { name: "Duckygram", description: "Ã–zel Ã¶rdek koleksiyonu.", icon: "https://api.dicebear.com/7.x/bottts/svg?seed=duck", link: "#" },
                        { name: "8 Bit World", description: "Retro dÃ¼nyada macera.", icon: "https://api.dicebear.com/7.x/bottts/svg?seed=8bit", link: "#" },
                        { name: "Max Indie", description: "No-code uygulama platformu.", icon: "https://api.dicebear.com/7.x/bottts/svg?seed=max", link: "#" }
                    ];
                }

                gameList.innerHTML = '';
                bannerList.innerHTML = '';
                bannerDots.innerHTML = '';
                
                gamesData.forEach((game, index) => {
                    gameList.innerHTML += `
                        <div class="flex items-center justify-between bg-white p-2 rounded-2xl border border-transparent active:border-cyan-100 transition-all">
                            <div class="flex items-center gap-3">
                                <img src="${game.icon}" class="w-16 h-16 rounded-2xl object-cover bg-gray-50 shadow-sm border">
                                <div>
                                    <h3 class="font-bold text-gray-800 text-base">${game.name}</h3>
                                    <p class="text-xs text-gray-400 line-clamp-1">${game.description}</p>
                                </div>
                            </div>
                            <button onclick="window.open('${game.link}', '_blank')" class="btn-start text-white px-5 py-2 rounded-xl font-bold text-sm min-w-[90px]">
                                ${game.name === 'CowHub' ? 'Start' : 'BaÅŸlangÄ±Ã§'}
                            </button>
                        </div>
                    `;

                    if (index < 4) {
                        bannerList.innerHTML += `
                            <div class="banner-card shadow-md" onclick="window.open('${game.link}', '_blank')">
                                <img src="${game.banner || 'https://picsum.photos/seed/'+index+'/800/400'}" class="w-full h-full object-cover">
                                <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent flex flex-col justify-end p-4">
                                    <span class="bg-cyan-500 text-white text-[10px] px-2 py-0.5 rounded-full font-bold w-fit mb-1 uppercase tracking-wider">Editor's Choice</span>
                                    <h4 class="text-white font-bold text-xl">${game.name}</h4>
                                </div>
                            </div>
                        `;
                        bannerDots.innerHTML += `<div class="dot-indicator ${index === 0 ? 'dot-active' : ''}"></div>`;
                    }
                });

                startAutoSlide();

            } catch (e) {
                gameList.innerHTML = `<p class="text-center text-gray-400 py-10">YÃ¼kleme sÄ±rasÄ±nda bir hata oluÅŸtu.</p>`;
            }
        }

        function startAutoSlide() {
            const container = bannerList;
            const dots = bannerDots.querySelectorAll('.dot-indicator');
            let currentIndex = 0;
            const total = dots.length;

            if (total === 0) return;

            container.addEventListener('scroll', () => {
                const index = Math.round(container.scrollLeft / (container.clientWidth * 0.9));
                dots.forEach((dot, i) => {
                    dot.classList.toggle('dot-active', i === index);
                });
                currentIndex = index;
            });

            autoSlideInterval = setInterval(() => {
                currentIndex = (currentIndex + 1) % total;
                const scrollAmount = currentIndex * (container.scrollWidth / total);
                container.scrollTo({ left: scrollAmount, behavior: 'smooth' });
            }, 3000);

            container.addEventListener('touchstart', () => clearInterval(autoSlideInterval));
        }

        initApp();
    </script>
</body>
</html>
