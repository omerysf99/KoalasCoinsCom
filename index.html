<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haber Portalı | Canlı Akış</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #f8f9fa; --card: #ffffff; --text: #212529;
            --accent: #d32f2f; --admin: #673ab7; --border: #dee2e6;
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; }
        .container { max-width: 600px; margin: 0 auto; padding: 10px; }

        /* Reklam & Kod Sistemi */
        #ad-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; z-index: 10000; flex-direction: column;
            align-items: center; justify-content: center; padding: 20px; color: white;
        }
        #security-alert {
            position: fixed; bottom: 70px; left: 50%; transform: translateX(-50%);
            background: #212121; color: #ffeb3b; padding: 10px 25px; border-radius: 5px;
            font-weight: 800; display: none; z-index: 10001; border: 1px solid #ffeb3b;
        }

        /* Haber Tasarımı (Haberler.com Stili) */
        .news-card {
            background: var(--card); border-radius: 8px; overflow: hidden;
            margin-bottom: 15px; border-bottom: 3px solid var(--accent);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer;
        }
        .news-img { width: 100%; height: 220px; object-fit: cover; }
        .news-body { padding: 15px; }
        .source { font-size: 11px; font-weight: bold; color: var(--accent); text-transform: uppercase; }
        .news-title { font-size: 1.2rem; font-weight: 800; margin: 5px 0; line-height: 1.3; }
        .news-excerpt { font-size: 0.9rem; color: #6c757d; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* Detay Modalı */
        #detail-view { position: fixed; inset: 0; background: white; display: none; overflow-y: auto; z-index: 9999; }
        .close-btn { position: sticky; top: 10px; left: 10px; background: var(--accent); color: white; border: none; padding: 8px 15px; border-radius: 5px; z-index: 10002; }

        #admin-panel { display: none; background: #e9ecef; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid var(--admin); }
        input, textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid var(--border); border-radius: 4px; }
    </style>
</head>
<body>

<div id="ad-overlay">
    <div style="background:white; color:black; padding:20px; border-radius:10px; text-align:center;">
        <h2 style="color:var(--accent)">REKLAM</h2>
        <p>En uygun fiyatlı uçuş biletleri için hemen tıkla!</p>
        <button onclick="closeAd()" style="background:black; color:white; padding:10px 20px; border:none; border-radius:5px;">Kapat ve Kodu Al</button>
    </div>
</div>

<div id="security-alert">GÜVENLİK KODU: <span id="code-val">-----</span></div>

<div class="container">
    <header style="border-bottom: 4px solid var(--accent); padding-bottom: 10px; margin-bottom: 15px;">
        <h1 style="margin:0; font-size: 1.5rem; color: var(--accent);">HABERLER<span style="color:#000">.com</span></h1>
    </header>

    <div id="admin-panel">
        <h4 style="margin:0 0 10px 0;">Admin</h4>
        <input type="text" id="h-title" placeholder="Flaş Haber Başlığı">
        <textarea id="h-content" placeholder="Haber Detayı..."></textarea>
        <button onclick="manualAdd()" style="width:100%; background:var(--admin); color:white; border:none; padding:10px;">YAYINLA</button>
    </div>

    <div id="loader" style="text-align:center; padding:20px;">Haberler çekiliyor...</div>
    <div id="news-container"></div>
</div>

<div id="detail-view">
    <button class="close-btn" onclick="closeDetail()">← Geri</button>
    <div id="detail-content" style="padding: 20px;"></div>
</div>

<script>
    const ADMIN_ID = 8392479231;
    const RSS_URL = "https://www.haberler.com/rss.xml";
    // RSS'i JSON'a çeviren ücretsiz köprü (Proxy)
    const API_CONVERTER = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(RSS_URL)}`;

    async function fetchNews() {
        try {
            const response = await fetch(API_CONVERTER);
            const data = await response.json();
            if(data.status === 'ok') {
                renderNews(data.items);
                document.getElementById('loader').style.display = 'none';
            }
        } catch (error) {
            document.getElementById('loader').innerText = "Haberler şu an yüklenemedi.";
        }
    }

    function renderNews(items) {
        const container = document.getElementById('news-container');
        items.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'news-card';
            card.onclick = () => openDetail(item);
            card.innerHTML = `
                <img src="${item.enclosure.link || 'https://picsum.photos/seed/'+index+'/400/220'}" class="news-img">
                <div class="news-body">
                    <span class="source">HABERLER.COM • SON DAKİKA</span>
                    <h2 class="news-title">${item.title}</h2>
                    <p class="news-excerpt">${item.description.replace(/<[^>]*>?/gm, '')}</p>
                </div>
            `;
            container.appendChild(card);
        });
    }

    function openDetail(item) {
        const content = `
            <img src="${item.enclosure.link}" style="width:100%; border-radius:10px;">
            <h1 style="font-size:1.5rem; margin:20px 0;">${item.title}</h1>
            <div style="line-height:1.7; font-size:1.1rem; color:#444;">${item.content || item.description}</div>
            <a href="${item.link}" target="_blank" style="display:block; margin-top:20px; color:var(--accent); font-weight:bold;">Kaynağa Git →</a>
        `;
        document.getElementById('detail-content').innerHTML = content;
        document.getElementById('detail-view').style.display = 'block';
    }

    function closeDetail() { document.getElementById('detail-view').style.display = 'none'; }

    // Reklam & Güvenlik Kodu (Strateji: İlk+Son = Çift)
    function generateCode() {
        let code;
        while(true) {
            code = Math.floor(10000 + Math.random() * 90000);
            let d = code.toString().split('').map(Number);
            if((d[0] + d[4]) % 2 === 0) break;
        }
        return code;
    }

    function showAd() { document.getElementById('ad-overlay').style.display = 'flex'; }
    function closeAd() {
        document.getElementById('ad-overlay').style.display = 'none';
        const code = generateCode();
        document.getElementById('code-val').innerText = code;
        document.getElementById('security-alert').style.display = 'block';
        setTimeout(() => document.getElementById('security-alert').style.display = 'none', 5000);
    }

    function manualAdd() {
        const t = document.getElementById('h-title').value;
        const c = document.getElementById('h-content').value;
        if(!t) return;
        const container = document.getElementById('news-container');
        const div = document.createElement('div');
        div.className = 'news-card';
        div.innerHTML = `<div class="news-body"><span class="source">ÖZEL FLAŞ</span><h2 class="news-title">${t}</h2><p>${c}</p></div>`;
        container.prepend(div);
        document.getElementById('h-title').value = "";
    }

    // Başlat
    try {
        const tg = window.Telegram.WebApp;
        if (tg.initDataUnsafe?.user?.id === ADMIN_ID) document.getElementById('admin-panel').style.display = 'block';
    } catch(e){}

    fetchNews();
    setInterval(showAd, 30000); // 30 sn reklam
</script>
</body>
</html>
