<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shorts Pro - √áakƒ±≈üma Fix</title>
    <style>
        body { margin: 0; background: #000; color: white; font-family: sans-serif; overflow: hidden; }
        .reels-wrapper { width: 100%; max-width: 400px; height: 100vh; margin: auto; position: relative; background: #000; }
        
        .reels-container {
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .reels-container::-webkit-scrollbar { display: none; }

        .video-card {
            height: 100vh;
            width: 100%;
            scroll-snap-align: start;
            scroll-snap-stop: always;
            position: relative;
            background: #000;
        }
        iframe { width: 100%; height: 100%; pointer-events: none; transform: scale(1.4); }

        /* Aray√ºz Elemanlarƒ± */
        .side-bar { position: absolute; right: 15px; bottom: 120px; z-index: 100; display: flex; flex-direction: column; gap: 20px; }
        .action-btn { background: rgba(255,255,255,0.1); border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(5px); font-size: 24px; }
        .click-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; }
        .info { position: absolute; bottom: 30px; left: 15px; z-index: 60; text-shadow: 0 2px 4px #000; }
    </style>
</head>
<body>

<div class="reels-wrapper">
    <div class="reels-container" id="reelsContainer"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
    const videos = [
        { id: 'znv__YAlrTQ', title: '√ñlene Kadar A≈üƒ±k ‚ú®' },
        { id: 'dj7QJ0-VIHc', title: 'T√ºrkiye Hitleri 2025' },
        { id: 'fkDpX8UXHN4', title: 'Dans Challenge üî•' },
        { id: 'lB6IgV1kapU', title: 'Yeni Pop√ºler Par√ßa' }
    ];

    const players = {};

    function onYouTubeIframeAPIReady() {
        const container = document.getElementById('reelsContainer');
        
        videos.forEach((v, index) => {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.setAttribute('data-id', v.id);
            card.innerHTML = `
                <div class="click-layer" onclick="handleTap('${v.id}')"></div>
                <div id="player-${v.id}"></div>
                <div class="side-bar">
                    <div class="action-btn">‚ù§Ô∏è</div>
                    <div class="action-btn">üí¨</div>
                </div>
                <div class="info"><strong>@benim_sitem</strong><p>${v.title}</p></div>
            `;
            container.appendChild(card);

            players[v.id] = new YT.Player(`player-${v.id}`, {
                videoId: v.id,
                playerVars: { 'autoplay': 0, 'controls': 0, 'loop': 1, 'playlist': v.id, 'mute': 1, 'modestbranding': 1 },
                events: { 'onReady': (e) => { if(index === 0) e.target.playVideo(); } }
            });
        });

        setupObserver();
    }

    // √áAKI≈ûMAYI D√úZELTEN ANA FONKSƒ∞YON
    function setupObserver() {
        const options = { threshold: 0.85 }; // Video %85 ekrandaysa tetiklenir
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const id = entry.target.getAttribute('data-id');
                
                if (entry.isIntersecting) {
                    // 1. √ñNCE Dƒ∞ƒûER T√úM Vƒ∞DEOLARI KESƒ∞N OLARAK DURDUR
                    Object.values(players).forEach(p => {
                        if (p && typeof p.pauseVideo === 'function') {
                            p.pauseVideo();
                        }
                    });

                    // 2. SADECE AKTƒ∞F Vƒ∞DEOYU BA≈ûLAT VE SESƒ∞Nƒ∞ A√á
                    if (players[id] && typeof players[id].playVideo === 'function') {
                        players[id].playVideo();
                        players[id].unMute();
                    }
                } else {
                    // Ekrandan √ßƒ±kanƒ± durdur ve sesini kapat
                    if (players[id] && typeof players[id].pauseVideo === 'function') {
                        players[id].pauseVideo();
                        players[id].mute();
                    }
                }
            });
        }, options);

        document.querySelectorAll('.video-card').forEach(card => observer.observe(card));
    }

    function handleTap(id) {
        const state = players[id].getPlayerState();
        state === 1 ? players[id].pauseVideo() : players[id].playVideo();
    }
</script>
</body>
</html>
