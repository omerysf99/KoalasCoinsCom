<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>KOALA ARCADE | ULTIMATE EDITION</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        
        :root {
            --bg: #000000;
            --card: #0c0c0c;
            --accent: #ffffff;
            --text-dim: #555555;
            --success: #34c759;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            background-color: var(--bg);
            color: var(--accent);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Sayfa Geçişleri */
        .page {
            display: none;
            flex: 1;
            flex-direction: column;
            padding: 30px 20px 120px;
            overflow-y: auto;
            animation: dogsFadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page.active { display: flex; }

        @keyframes dogsFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* DOGS Tarzı Checking Satırları */
        .check-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid #111;
            color: var(--text-dim);
            font-weight: 700;
            transition: 0.3s;
        }

        .check-item.active { color: #fff; }
        .check-item.done { color: var(--success); }

        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid #222;
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .check-icon { display: none; font-size: 18px; }
        .check-item.done .check-icon { display: block; }
        .check-item.done .spinner { display: none; }

        /* Kart Yapısı */
        .card {
            background: var(--card);
            border: 1px solid #1a1a1a;
            border-radius: 28px;
            padding: 20px;
            margin-bottom: 12px;
        }

        .koala-main {
            width: 240px;
            height: 240px;
            background: #fff;
            border-radius: 60px;
            margin: 20px auto;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            transform: rotate(-2deg);
        }

        .koala-main img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: grayscale(1);
        }

        /* Butonlar */
        .btn-dogs {
            background: #fff;
            color: #000;
            font-weight: 900;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-dogs:active { transform: scale(0.96); opacity: 0.9; }

        /* Navigasyon */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 90px;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid #111;
            display: flex;
            align-items: center;
            z-index: 999;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: #444;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
        }

        .nav-item.active { color: #fff; }
        .nav-item i { font-size: 20px; }

        /* Inputlar */
        input {
            background: #111;
            border: 1px solid #222;
            padding: 18px;
            border-radius: 18px;
            color: #fff;
            font-family: monospace;
            width: 100%;
            outline: none;
            margin-bottom: 12px;
        }

        input:focus { border-color: #fff; }
    </style>
</head>
<body>

<div id="app" class="flex flex-col h-full">

    <div id="p-check" class="page">
        <div class="mt-10 mb-10">
            <h1 class="text-4xl font-black italic uppercase leading-none">Hesabın<br>Analiz Ediliyor</h1>
            <p class="text-zinc-600 font-bold text-xs mt-4 uppercase tracking-widest">Koala Arcade Güvenlik Kontrolü</p>
        </div>

        <div class="flex-1">
            <div id="c1" class="check-item"><span>Telegram Üyelik Yaşı</span><div class="status"><div class="spinner"></div><i class="fa-solid fa-check check-icon"></i></div></div>
            <div id="c2" class="check-item"><span>Premium Üyelik Kontrolü</span><div class="status"><div class="spinner"></div><i class="fa-solid fa-check check-icon"></i></div></div>
            <div id="c3" class="check-item"><span>Kullanıcı Kimliği Doğrulama</span><div class="status"><div class="spinner"></div><i class="fa-solid fa-check check-icon"></i></div></div>
            <div id="c4" class="check-item"><span>Koala Puanı Hesaplama</span><div class="status"><div class="spinner"></div><i class="fa-solid fa-check check-icon"></i></div></div>
        </div>

        <div id="btn-start-container">
            <div onclick="startFullAnalysis()" class="btn-dogs">Analizi Başlat</div>
        </div>
    </div>

    <div id="p-reward" class="page justify-center text-center">
        <h3 class="text-zinc-500 font-black text-xs uppercase tracking-widest mb-6">Analiz Tamamlandı</h3>
        <div class="koala-main mx-auto mb-10"><img src="coinkoala.jpg"></div>
        <h1 class="text-6xl font-black italic mb-2" id="gift-text">0</h1>
        <p class="text-zinc-400 font-bold text-sm mb-12">$KOALA Hediye Kazandın</p>
        <div onclick="finishOnboarding()" class="btn-dogs">Madenciliği Başlat</div>
    </div>

    <div id="p-home" class="page">
        <div class="text-center mt-4">
            <p class="text-zinc-500 font-black text-[11px] uppercase tracking-[0.4em] mb-2">Mevcut Bakiye</p>
            <h2 class="text-6xl font-black italic mb-10" id="main-bal">0.00</h2>
            
            <div class="koala-main mx-auto"><img src="coinkoala.jpg"></div>

            <div class="grid grid-cols-2 gap-3 mt-12">
                <div class="card !text-left">
                    <p class="text-[9px] text-zinc-500 font-black uppercase mb-1">Sabit Hız</p>
                    <p class="text-xl font-black italic">+128.50</p>
                </div>
                <div class="card !text-left border-l-2 border-white/20">
                    <p class="text-[9px] text-zinc-500 font-black uppercase mb-1">Boost Hız</p>
                    <p class="text-xl font-black italic">+<span id="boost-val">0.00</span></p>
                </div>
            </div>
        </div>
    </div>

    <div id="p-boost" class="page">
        <h2 class="text-4xl font-black italic uppercase mb-10">Hızlandır</h2>
        <div class="card flex justify-between items-center py-8">
            <div>
                <h4 class="font-black italic text-lg uppercase">Video Reklam</h4>
                <p class="text-zinc-500 text-[10px] font-bold uppercase mt-1">+1.00 PPH / 24 Saatlik Kira</p>
            </div>
            <div onclick="watchBoostAd()" class="bg-white text-black px-6 py-3 rounded-2xl font-black text-xs uppercase">İzle</div>
        </div>
    </div>

    <div id="p-airdrop" class="page">
        <h2 class="text-4xl font-black italic uppercase mb-10">Airdrop</h2>
        
        <div id="wallet-setup">
            <p class="text-zinc-500 text-[10px] font-bold uppercase mb-4 ml-1">Borsa Seçimi</p>
            <div class="flex gap-3 mb-8">
                <img src="binance.jpg" class="w-16 h-16 rounded-[20px] border-2 border-transparent" id="ex-bin" onclick="selectExchange('Binance')">
                <img src="okx.jpg" class="w-16 h-16 rounded-[20px] border-2 border-transparent" id="ex-okx" onclick="selectExchange('OKX')">
                <img src="bitget.jpg" class="w-16 h-16 rounded-[20px] border-2 border-transparent" id="ex-bit" onclick="selectExchange('Bitget')">
            </div>
            <p class="text-zinc-500 text-[10px] font-bold uppercase mb-2 ml-1">TON Yatırma Adresi</p>
            <input type="text" id="wallet-input" placeholder="UQ... veya EQA...">
            <div onclick="saveWalletData()" class="btn-dogs mt-4">Adresi Kaydet</div>
        </div>

        <div id="wallet-status" class="hidden">
            <div class="card text-center py-12 border-white/10">
                <div class="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fa-solid fa-check-double text-3xl"></i>
                </div>
                <h3 class="text-2xl font-black italic uppercase" id="display-ex">-</h3>
                <p class="text-zinc-500 font-mono text-[10px] mt-4 mb-8 break-all px-4" id="display-addr">-</p>
                <div onclick="resetWallet()" class="text-zinc-700 font-black text-[10px] uppercase underline">Bilgileri Güncelle</div>
            </div>
        </div>
    </div>

    <nav class="nav-bar" id="main-nav" style="display: none;">
        <div class="nav-item active" onclick="navigate('home', this)"><i class="fa-solid fa-cube"></i><span>MADEN</span></div>
        <div class="nav-item" onclick="navigate('boost', this)"><i class="fa-solid fa-bolt"></i><span>BOOST</span></div>
        <div class="nav-item" onclick="navigate('airdrop', this)"><i class="fa-solid fa-wallet"></i><span>AIRDROP</span></div>
    </nav>

</div>

<script>
    // --- FIREBASE YAPILANDIRMASI ---
    const firebaseConfig = {
        apiKey: "AIzaSyAJbCj95zZf2VTGH196clZpu5nYm47ESpY",
        authDomain: "koalascombom.firebaseapp.com",
        projectId: "koalascombom",
        storageBucket: "koalascombom.firebasestorage.app",
        messagingSenderId: "533011982418",
        appId: "1:533011982418:web:9e8e50e93a99017062d78b"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // --- KULLANICI DURUMU ---
    let uid = localStorage.getItem('koala_user_id') || 'k_' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('koala_user_id', uid);

    let state = {
        balance: 0,
        lastUpdate: Date.now(),
        hasFinishedChecking: false,
        boosts: [], // { id: 1, exp: timestamp }
        selectedEx: 'Binance',
        walletAddr: ''
    };

    // --- BAŞLANGIÇ SİSTEMİ ---
    async function initApp() {
        const userDoc = await db.collection("players").doc(uid).get();
        
        if (userDoc.exists) {
            const data = userDoc.data();
            state = { ...state, ...data };
            
            // ÇEVRİMDIŞI KAZANÇ HESAPLAMA (ÖMÜRLÜK MİNER)
            const now = Date.now();
            const elapsedSeconds = (now - state.lastUpdate) / 1000;
            const currentPPH = 128.50 + state.boosts.length;
            const earned = (currentPPH / 3600) * elapsedSeconds;
            
            state.balance += earned;
            state.lastUpdate = now;

            if (state.hasFinishedChecking) {
                showPage('home');
                document.getElementById('main-nav').style.display = 'flex';
            } else {
                showPage('check');
            }
        } else {
            showPage('check');
        }
        updateUI();
        startMiningLoop();
    }

    // --- DOGS ANALİZ AKIŞI ---
    function startFullAnalysis() {
        document.getElementById('btn-start-container').style.display = 'none';
        const rows = ['c1', 'c2', 'c3', 'c4'];
        
        rows.forEach((id, index) => {
            setTimeout(() => {
                const el = document.getElementById(id);
                el.classList.add('active');
                
                setTimeout(() => {
                    el.classList.replace('active', 'done');
                    if (index === 3) {
                        const gift = Math.floor(Math.random() * 35000) + 5000;
                        state.balance = gift;
                        document.getElementById('gift-text').innerText = gift.toLocaleString();
                        showPage('reward');
                    }
                }, 1500);
            }, index * 1800);
        });
    }

    function finishOnboarding() {
        state.hasFinishedChecking = true;
        state.lastUpdate = Date.now();
        syncData();
        showPage('home');
        document.getElementById('main-nav').style.display = 'flex';
    }

    // --- MADENCİLİK DÖNGÜSÜ ---
    function startMiningLoop() {
        setInterval(() => {
            if (state.hasFinishedChecking) {
                const currentPPH = 128.50 + state.boosts.length;
                state.balance += (currentPPH / 3600);
                state.lastUpdate = Date.now();
                
                // Boost süresi kontrolü
                const now = Date.now();
                state.boosts = state.boosts.filter(b => b.exp > now);
                
                updateUI();
            }
        }, 1000);

        // Her 20 saniyede bir sessizce Firebase'e yedekle
        setInterval(() => {
            if (state.hasFinishedChecking) syncData();
        }, 20000);
    }

    // --- CÜZDAN İŞLEMLERİ ---
    function selectExchange(name) {
        state.selectedEx = name;
        const ids = { 'Binance': 'ex-bin', 'OKX': 'ex-okx', 'Bitget': 'ex-bit' };
        Object.values(ids).forEach(id => document.getElementById(id).style.borderColor = 'transparent');
        document.getElementById(ids[name]).style.borderColor = '#fff';
    }

    function saveWalletData() {
        const val = document.getElementById('wallet-input').value;
        if (val.length < 10) return alert("Hatalı TON Adresi");
        state.walletAddr = val;
        syncData();
        updateUI();
    }

    function resetWallet() {
        state.walletAddr = '';
        updateUI();
    }

    // --- BOOST (REKLAM) ---
    function watchBoostAd() {
        alert("Video Yükleniyor...");
        setTimeout(() => {
            state.boosts.push({ id: Date.now(), exp: Date.now() + (24 * 60 * 60 * 1000) });
            syncData();
            updateUI();
            alert("Harika! +1.00 PPH hızı 24 saatliğine eklendi.");
        }, 2000);
    }

    // --- YARDIMCI FONKSİYONLAR ---
    function updateUI() {
        document.getElementById('main-bal').innerText = state.balance.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        document.getElementById('boost-val').innerText = state.boosts.length.toFixed(2);
        
        if (state.walletAddr) {
            document.getElementById('wallet-setup').classList.add('hidden');
            document.getElementById('wallet-status').classList.remove('hidden');
            document.getElementById('display-ex').innerText = state.selectedEx;
            document.getElementById('display-addr').innerText = state.walletAddr;
        } else {
            document.getElementById('wallet-setup').classList.remove('hidden');
            document.getElementById('wallet-status').classList.add('hidden');
        }
    }

    function showPage(pId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('p-' + pId).classList.add('active');
    }

    function navigate(pId, el) {
        showPage(pId);
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
    }

    async function syncData() {
        try {
            await db.collection("players").doc(uid).set(state);
        } catch (e) { console.error("Sync Error", e); }
    }

    // --- ÇALIŞTIR ---
    window.onload = initApp;

</script>
</body>
</html>
