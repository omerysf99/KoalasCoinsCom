<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shorts API Fix</title>
    <style>
        body { margin: 0; background: #000; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        .reels-wrapper { width: 100%; max-width: 420px; height: 100vh; margin: auto; position: relative; }
        
        .reels-container {
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scrollbar-width: none;
        }
        .reels-container::-webkit-scrollbar { display: none; }

        .video-card {
            height: 100vh;
            width: 100%;
            scroll-snap-align: start;
            scroll-snap-stop: always;
            position: relative;
            background: #000;
        }

        /* Video tam ekran ve ortalƒ± */
        iframe { width: 100%; height: 100%; pointer-events: none; transform: scale(1.4); }

        /* Aray√ºz */
        .side-bar { position: absolute; right: 15px; bottom: 100px; z-index: 100; display: flex; flex-direction: column; gap: 20px; }
        .action-btn { background: rgba(255,255,255,0.15); border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(10px); font-size: 24px; }
        .click-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; }
        .video-info { position: absolute; bottom: 30px; left: 15px; z-index: 60; text-shadow: 0 2px 4px black; }
    </style>
</head>
<body>

<div class="reels-wrapper">
    <div class="reels-container" id="reelsContainer"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
    // Senin API Key'in
    const API_KEY = 'AIzaSyD1ie6u6qh7ef2dR64_ZICI2W20_FCs8LI';
    
    // G√ºncel Pop√ºler Shorts ID Listesi
    const videoData = [
        { id: 'znv__YAlrTQ', title: '√ñlene Kadar A≈üƒ±k Olamazsƒ±n' },
        { id: 'dj7QJ0-VIHc', title: 'Her Yƒ±lƒ±n En √áok Dinlenen ≈ûarkƒ±sƒ±' },
        { id: 'fkDpX8UXHN4', title: 'Bir Dans Bu Kadar Mƒ± Tatlƒ± Olur?' },
        { id: 'lB6IgV1kapU', title: 'Beg√ºm Polat - Kahpe' },
        { id: 'XHYVGwXC4Tc', title: '≈ûarkƒ± Yaparken Benim Haller' }
    ];

    const players = {};

    function onYouTubeIframeAPIReady() {
        const container = document.getElementById('reelsContainer');
        
        videoData.forEach((v, index) => {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.setAttribute('data-id', v.id);
            card.innerHTML = `
                <div class="click-layer" onclick="handleTap('${v.id}')"></div>
                <div id="player-${v.id}"></div>
                <div class="side-bar">
                    <div class="action-btn" onclick="event.stopPropagation(); alert('Sana √∂zel beƒüenildi!')">‚ù§Ô∏è</div>
                    <div class="action-btn" onclick="event.stopPropagation(); prompt('Yorumun nedir?')">üí¨</div>
                    <div class="action-btn">üîñ</div>
                </div>
                <div class="video-info">
                    <strong>@benim_sitem</strong>
                    <p>${v.title}</p>
                </div>
            `;
            container.appendChild(card);

            players[v.id] = new YT.Player(`player-${v.id}`, {
                videoId: v.id,
                playerVars: { 
                    'autoplay': 0, 
                    'controls': 0, 
                    'loop': 1, 
                    'playlist': v.id, 
                    'mute': 1, 
                    'modestbranding': 1,
                    'rel': 0
                },
                events: {
                    'onReady': (e) => { 
                        // ƒ∞lk videoyu ba≈ülat
                        if(index === 0) {
                            e.target.playVideo();
                            e.target.unMute();
                        }
                    }
                }
            });
        });

        setupStrictObserver();
    }

    // √áAKI≈ûMAYI KESƒ∞N √ñNLEYEN G√ñZLEMCƒ∞
    function setupStrictObserver() {
        const options = { threshold: 0.8 }; // Video %80 ekrana oturunca tetiklenir
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const id = entry.target.getAttribute('data-id');
                
                if (entry.isIntersecting) {
                    // KESƒ∞N √á√ñZ√úM: Yeni video ba≈ülamadan √∂nce Dƒ∞ƒûER T√úM videolarƒ± durdur
                    Object.keys(players).forEach(key => {
                        if (key !== id && players[key].pauseVideo) {
                            players[key].pauseVideo();
                            players[key].mute();
                        }
                    });

                    // Aktif videoyu oynat
                    if (players[id] && players[id].playVideo) {
                        players[id].playVideo();
                        players[id].unMute();
                    }
                } else {
                    // Ekrandan √ßƒ±kan videoyu anƒ±nda durdur
                    if (players[id] && players[id].pauseVideo) {
                        players[id].pauseVideo();
                    }
                }
            });
        }, options);

        document.querySelectorAll('.video-card').forEach(card => observer.observe(card));
    }

    // Tek tƒ±kla Durdur/Ba≈ülat
    function handleTap(id) {
        const state = players[id].getPlayerState();
        if (state === YT.PlayerState.PLAYING) {
            players[id].pauseVideo();
        } else {
            players[id].playVideo();
        }
    }
</script>
</body>
</html>
