<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>KOALA ARCADE | PRO ADS</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://adexora.com/cdn/ads.js?id=1624"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        :root { --bg: #000; --card: #111; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; position: fixed; width: 100%; }
        
        .page { display: none; height: 100vh; flex-direction: column; padding: 110px 24px 130px; overflow-y: auto; }
        .page.active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .k-btn { background: #fff; color: #000; font-weight: 900; border-radius: 14px; padding: 18px; text-align: center; width: 100%; cursor: pointer; border: none; }
        .ex-option { border: 2px solid #222; border-radius: 15px; padding: 15px; display: flex; align-items: center; gap: 15px; margin-bottom: 10px; }
        .ex-option.selected { border-color: #fcd535; background: #1a1a1a; }
        
        nav { position: fixed; bottom: 0; width: 100%; height: 95px; background: #000; border-top: 1px solid #111; display: flex; padding-bottom: 30px; }
        .nav-link { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #444; font-size: 10px; font-weight: 700; }
        .nav-link.active { color: #fff; }
    </style>
</head>
<body>

    <div id="p-earn" class="page active">
        <div class="text-center mb-8">
            <h1 id="ui-bal" class="text-7xl font-black italic">0</h1>
            <p class="text-[10px] text-zinc-600 font-black tracking-[4px] uppercase">Total Koala</p>
        </div>
        <div class="mx-auto w-[220px] h-[220px] bg-[#111] rounded-[50px] border-4 border-[#222] p-4 mb-10">
            <img src="coinkoala.jpg" class="w-full h-full object-cover rounded-[30px]">
        </div>
        <button class="k-btn" onclick="watchAd()">
            <i class="fa-solid fa-play mr-2"></i> Watch Ad & Mine
        </button>
    </div>

    <div id="p-wallet" class="page">
        <h1 class="text-4xl font-black mb-6 uppercase italic">Borsa</h1>
        <div id="exchange-list">
            <div class="ex-option" id="ex-binance" onclick="setEx('Binance')">
                <img src="binance.jpg" class="w-10 h-10 rounded-lg">
                <p class="font-black uppercase">Binance</p>
            </div>
            <div class="ex-option" id="ex-okx" onclick="setEx('OKX')">
                <img src="okx.jpg" class="w-10 h-10 rounded-lg">
                <p class="font-black uppercase">OKX</p>
            </div>
            <div class="ex-option" id="ex-bitget" onclick="setEx('Bitget')">
                <img src="bitget.jpg" class="w-10 h-10 rounded-lg">
                <p class="font-black uppercase">Bitget</p>
            </div>
        </div>
    </div>

    <nav>
        <div class="nav-link active" onclick="tab('earn', this)"><i class="fa-solid fa-house"></i><span>Home</span></div>
        <div class="nav-link" onclick="tab('wallet', this)"><i class="fa-solid fa-wallet"></i><span>Borsa</span></div>
    </nav>

<script>
    const firebaseConfig = { apiKey: "AIza...", projectId: "koalascombom" }; 
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const tg = window.Telegram.WebApp;

    let myId = tg.initDataUnsafe?.user?.id ? String(tg.initDataUnsafe.user.id) : "TEST_USER";
    let u = { bal: 0, exchange: null };

    // REKLAM FONKSİYONU
    function watchAd() {
        if (window.showAdexora) {
            window.showAdexora()
                .then(() => {
                    addReward(100); // Başarılı izleme ödülü
                    tg.HapticFeedback.notificationOccurred('success');
                })
                .catch(e => {
                    console.error("Ad error:", e);
                    alert("Reklam yüklenemedi, lütfen tekrar deneyin.");
                });
        } else {
            addReward(10); // Reklam servisi yoksa küçük ödül
        }
    }

    async function addReward(amount) {
        u.bal += amount;
        await db.collection("users").doc(myId).set(u, { merge: true });
        render();
    }

    async function setEx(name) {
        u.exchange = name;
        await db.collection("users").doc(myId).set({ exchange: name }, { merge: true });
        render();
    }

    function render() {
        document.getElementById('ui-bal').innerText = Math.floor(u.bal).toLocaleString();
        document.querySelectorAll('.ex-option').forEach(el => {
            el.classList.toggle('selected', el.id === 'ex-' + u.exchange?.toLowerCase());
        });
    }

    function tab(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('p-' + id).classList.add('active');
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        el.classList.add('active');
    }

    // Verileri çek
    db.collection("users").doc(myId).get().then(doc => {
        if(doc.exists) u = doc.data();
        render();
    });
</script>
</body>
</html>
