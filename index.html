<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>KOALA ARCADE PRO | ENERGY UPDATE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@300;400;600;800;900&display=swap');
        
        :root { --primary: #00ffa3; --energy: #fbbf24; --bg: #000; --glass: rgba(255, 255, 255, 0.03); --border: rgba(255, 255, 255, 0.08); }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Inter', sans-serif; user-select: none; }
        body { background: var(--bg); color: #fff; overflow: hidden; height: 100vh; width: 100%; position: fixed; }

        .page { display: none; height: 100vh; overflow-y: auto; padding: 20px 20px 140px; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .glass { background: var(--glass); border: 1px solid var(--border); backdrop-filter: blur(15px); border-radius: 28px; }
        .neon-glow { color: var(--primary); text-shadow: 0 0 15px rgba(0,255,163,0.4); }
        
        /* Gelişmiş Koala Butonu */
        .tap-target { width: 260px; height: 260px; position: relative; cursor: pointer; transition: transform 0.05s; z-index: 10; margin: 0 auto; }
        .tap-target:active { transform: scale(0.94); }
        .koala-circle { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; border: 8px solid #0a0a0a; box-shadow: 0 0 40px rgba(0,0,0,0.8); transition: 0.3s; }
        
        /* Enerji Modu Stili */
        .energy-mode-active .koala-circle { border-color: var(--energy); box-shadow: 0 0 30px rgba(251, 191, 36, 0.5); filter: drop-shadow(0 0 10px var(--energy)); }

        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; height: 95px; background: rgba(5,5,5,0.9); border-top: 1px solid var(--border); display: grid; grid-template-columns: repeat(5, 1fr); padding-bottom: 25px; backdrop-filter: blur(10px); z-index: 1000; }
        .nav-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; color: #444; font-size: 9px; font-weight: 800; text-transform: uppercase; transition: 0.2s; }
        .nav-btn.active { color: #fff; transform: translateY(-3px); }
        .nav-btn i { font-size: 22px; margin-bottom: 4px; }

        .float-text { position: absolute; font-weight: 900; font-size: 32px; pointer-events: none; animation: float 0.8s ease-out forwards; font-family: 'Orbitron', sans-serif; z-index: 2000; }
        @keyframes float { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-120px); } }

        .market-card { background: linear-gradient(145deg, rgba(255,255,255,0.02), rgba(255,255,255,0.05)); border: 1px solid var(--border); padding: 16px; border-radius: 24px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }

        .bar-container { height: 10px; background: #0a0a0a; border-radius: 20px; border: 1px solid #151515; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.2s; }
        #energy-bar { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
    </style>
</head>
<body>

    <div id="app">
        
        <div id="p-main" class="page active">
            <div class="flex justify-between items-center mb-6">
                <div class="glass px-4 py-2 flex items-center gap-2">
                    <i class="fa-solid fa-bolt text-yellow-400 text-xs"></i>
                    <span id="energy-txt" class="text-[10px] font-black uppercase">1000/1000</span>
                </div>
                <button onclick="toggleMode()" id="mode-toggle" class="glass px-4 py-2 text-[10px] font-black uppercase text-amber-500 border-amber-500/20 bg-amber-500/5">
                    Enerji Topla
                </button>
            </div>

            <div class="flex flex-col items-center">
                <p id="status-label" class="text-zinc-500 font-black text-[10px] uppercase tracking-[0.5em] mb-2">Bakiyen</p>
                <div class="flex items-center gap-3 mb-8">
                    <h1 id="balance" class="text-7xl font-black tracking-tighter italic">0</h1>
                </div>

                <div class="tap-target" id="koala-btn">
                    <img src="coinkoala.jpg" class="koala-circle">
                </div>

                <div class="w-full max-w-[280px] mt-12">
                    <div class="bar-container mb-2">
                        <div id="energy-bar" class="bar-fill w-full"></div>
                    </div>
                    <div class="flex justify-between px-1">
                        <p class="text-[9px] font-bold text-zinc-600 uppercase">GÜÇ: <span id="tap-power" class="text-white">1</span></p>
                        <p id="mode-status" class="text-[9px] font-bold text-zinc-400 uppercase italic">Madencilik Modu</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="p-market" class="page">
            <h2 class="text-3xl font-black italic mb-6 uppercase tracking-tighter">Koala Market</h2>
            
            <div class="market-card">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 glass flex items-center justify-center text-xl text-primary"><i class="fa-solid fa-hand-pointer"></i></div>
                    <div>
                        <p class="text-sm font-bold">Tıklama Gücü</p>
                        <p class="text-[10px] text-zinc-500">Tık başı +1 kazanç verir.</p>
                    </div>
                </div>
                <button onclick="buyUpgrade('tap')" id="up-tap-price" class="bg-white text-black px-4 py-2 rounded-xl text-[10px] font-black uppercase">1,000</button>
            </div>

            <div class="market-card">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 glass flex items-center justify-center text-xl text-yellow-500"><i class="fa-solid fa-battery-full"></i></div>
                    <div>
                        <p class="text-sm font-bold">Şarj Hızı</p>
                        <p class="text-[10px] text-zinc-500">Enerji toplama modunda +2 verir.</p>
                    </div>
                </div>
                <button onclick="buyUpgrade('charge')" id="up-charge-price" class="bg-white text-black px-4 py-2 rounded-xl text-[10px] font-black uppercase">2,500</button>
            </div>
        </div>

        <div id="p-rank" class="page"><h2 class="text-3xl font-black italic mb-6 uppercase">Liderlik</h2><div id="leader-list" class="space-y-3"></div></div>
        <div id="p-crew" class="page text-center"><h2 class="text-4xl font-black italic mb-6 uppercase">Ekibin</h2><div class="glass p-6"><p id="ref-link" class="text-xs mb-4">link...</p><button onclick="shareLink()" class="w-full bg-white text-black p-4 rounded-2xl font-black">PAYLAŞ</button></div></div>
        <div id="p-airdrop" class="page"><h2 class="text-3xl font-black italic mb-6 uppercase">Airdrop</h2><div id="wallet-box" class="glass p-8 text-center"><input type="text" id="w-input" class="w-full bg-black p-4 mb-4 rounded-xl" placeholder="TON Adresi"><button onclick="saveWallet()" class="w-full bg-white text-black p-4 rounded-xl font-black">BAĞLA</button></div><div id="wallet-connected" class="hidden glass p-8 text-center"><p id="display-w" class="text-xs break-all"></p><button onclick="resetWallet()" class="underline text-xs mt-4">Sıfırla</button></div></div>

        <nav class="nav-bar">
            <div class="nav-btn active" onclick="nav('main', this)"><i class="fa-solid fa-fire"></i><span>Oyna</span></div>
            <div class="nav-btn" onclick="nav('market', this)"><i class="fa-solid fa-cart-shopping"></i><span>Market</span></div>
            <div class="nav-btn" onclick="nav('rank', this)"><i class="fa-solid fa-trophy"></i><span>Sıra</span></div>
            <div class="nav-btn" onclick="nav('crew', this)"><i class="fa-solid fa-user-group"></i><span>Ekip</span></div>
            <div class="nav-btn" onclick="nav('airdrop', this)"><i class="fa-solid fa-parachute-box"></i><span>Airdrop</span></div>
        </nav>
    </div>

    <script>
        // --- OYUN VERİLERİ ---
        let state = {
            bal: parseFloat(localStorage.getItem('k_bal')) || 0,
            energy: parseFloat(localStorage.getItem('k_energy')) || 1000,
            maxEnergy: 1000,
            tapPower: parseInt(localStorage.getItem('k_tap')) || 1,
            chargePower: parseInt(localStorage.getItem('k_charge')) || 2, // Enerji toplama hızı
            mode: 'MINE', // 'MINE' veya 'ENERGY'
            wallet: localStorage.getItem('k_wallet') || null,
            uid: localStorage.getItem('k_uid') || Math.floor(100000 + Math.random()*900000)
        };

        // --- MOD DEĞİŞTİRİCİ ---
        function toggleMode() {
            const btn = document.getElementById('mode-toggle');
            const target = document.getElementById('koala-btn');
            const statusLabel = document.getElementById('status-label');
            const modeStatus = document.getElementById('mode-status');

            if(state.mode === 'MINE') {
                state.mode = 'ENERGY';
                btn.innerText = 'Madencilik';
                btn.classList.replace('text-amber-500', 'text-primary');
                target.classList.add('energy-mode-active');
                statusLabel.innerText = 'Toplanan Enerji';
                modeStatus.innerText = 'Şarj Modu Aktif';
            } else {
                state.mode = 'MINE';
                btn.innerText = 'Enerji Topla';
                btn.classList.replace('text-primary', 'text-amber-500');
                target.classList.remove('energy-mode-active');
                statusLabel.innerText = 'Bakiyen';
                modeStatus.innerText = 'Madencilik Modu';
            }
        }

        // --- TIKLAMA MANTIĞI ---
        const btn = document.getElementById('koala-btn');
        btn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.changedTouches[0];

            if(state.mode === 'MINE') {
                // Madencilik Modu
                if(state.energy >= state.tapPower) {
                    state.bal += state.tapPower;
                    state.energy -= state.tapPower;
                    createFloat(touch.clientX, touch.clientY, `+${state.tapPower}`, '#fff');
                } else {
                    alert("Enerjin bitti! Enerji Topla moduna geç.");
                }
            } else {
                // Enerji Toplama Modu
                if(state.energy < state.maxEnergy) {
                    state.energy = Math.min(state.maxEnergy, state.energy + state.chargePower);
                    createFloat(touch.clientX, touch.clientY, `+${state.chargePower}⚡`, '#fbbf24');
                }
            }
            updateUI();
            save();
        });

        // --- MARKET SİSTEMİ ---
        function buyUpgrade(type) {
            if(type === 'tap') {
                let cost = state.tapPower * 1000;
                if(state.bal >= cost) {
                    state.bal -= cost;
                    state.tapPower++;
                } else { alert("Yetersiz bakiye!"); }
            } else if(type === 'charge') {
                let cost = state.chargePower * 1250;
                if(state.bal >= cost) {
                    state.bal -= cost;
                    state.chargePower += 2;
                } else { alert("Yetersiz bakiye!"); }
            }
            updateUI();
            save();
        }

        // --- UI GÜNCELLEME ---
        function updateUI() {
            document.getElementById('balance').innerText = Math.floor(state.bal).toLocaleString();
            document.getElementById('energy-txt').innerText = `${Math.floor(state.energy)}/${state.maxEnergy}`;
            document.getElementById('energy-bar').style.width = (state.energy / state.maxEnergy * 100) + "%";
            document.getElementById('tap-power').innerText = state.tapPower;
            
            // Fiyatlar
            document.getElementById('up-tap-price').innerText = (state.tapPower * 1000).toLocaleString();
            document.getElementById('up-charge-price').innerText = (state.chargePower * 1250).toLocaleString();
        }

        function createFloat(x, y, txt, color) {
            const d = document.createElement('div');
            d.className = 'float-text';
            d.innerText = txt;
            d.style.left = x + 'px'; d.style.top = y + 'px';
            d.style.color = color;
            document.body.appendChild(d);
            setTimeout(() => d.remove(), 800);
        }

        // --- STANDART FONKSİYONLAR ---
        function nav(p, el) {
            document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(n => n.classList.remove('active'));
            document.getElementById('p-' + p).classList.add('active');
            el.classList.add('active');
        }

        function save() {
            localStorage.setItem('k_bal', state.bal);
            localStorage.setItem('k_energy', state.energy);
            localStorage.setItem('k_tap', state.tapPower);
            localStorage.setItem('k_charge', state.chargePower);
        }

        window.onload = () => {
            document.getElementById('ref-link').innerText = `t.me/Koalas_Bot?start=r${state.uid}`;
            checkWalletUI();
            updateUI();
        };

        // Wallet fonksiyonları (Sizin kodunuzdan korundu)
        function saveWallet() { let v = document.getElementById('w-input').value; if(v.length < 10) return; state.wallet = v; localStorage.setItem('k_wallet', v); checkWalletUI(); }
        function resetWallet() { state.wallet = null; localStorage.removeItem('k_wallet'); checkWalletUI(); }
        function checkWalletUI() { if(state.wallet) { document.getElementById('wallet-box').classList.add('hidden'); document.getElementById('wallet-connected').classList.remove('hidden'); document.getElementById('display-w').innerText = state.wallet; } else { document.getElementById('wallet-box').classList.remove('hidden'); document.getElementById('wallet-connected').classList.add('hidden'); } }
    </script>
</body>
</html>
