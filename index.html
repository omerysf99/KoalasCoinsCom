<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oyun D√ºnyasƒ± - Tam S√ºr√ºm</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #ffffff;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            color: #1a1a1a;
        }
        .game-card:active { transform: scale(0.97); }
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        #admin-panel { transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .hidden-panel { transform: translateY(100%); }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen pb-24 relative overflow-x-hidden">

    <!-- √úst Header Bar -->
    <header class="flex items-center justify-between p-4 bg-white sticky top-0 z-40">
        <div class="flex items-center gap-2">
            <button class="text-gray-400 text-xl flex items-center gap-1">
                <i class="fa-solid fa-xmark"></i>
                <span class="text-sm font-medium">Kapat</span>
            </button>
        </div>
        <div class="flex items-center gap-2">
            <div class="bg-gray-100/80 px-3 py-1.5 rounded-full flex items-center gap-3">
                <i class="fa-solid fa-check text-gray-400 text-xs"></i>
                <div class="w-[1px] h-3 bg-gray-300"></div>
                <button onclick="toggleAdminAuth()"><i class="fa-solid fa-ellipsis text-gray-400"></i></button>
            </div>
        </div>
    </header>

    <!-- Kullanƒ±cƒ± Kar≈üƒ±lama B√∂l√ºm√º -->
    <section class="px-5 py-2 flex items-center justify-between mb-2">
        <h1 class="text-[22px] font-bold tracking-tight">
            Merhaba! Kullanƒ±cƒ± üåè üì£
        </h1>
        <div class="flex items-center gap-2">
            <div class="bg-gray-50 border border-gray-100 shadow-sm p-1.5 rounded-lg">
                <i class="fa-solid fa-bullhorn text-sm"></i>
            </div>
            <div class="bg-red-600 rounded p-1 w-8 h-5 flex items-center justify-center shadow-sm">
                <div class="text-white text-[10px] font-bold tracking-tighter">C*</div>
            </div>
        </div>
    </section>

    <!-- Dinamik Slider (Hero) B√∂l√ºm√º -->
    <section class="px-5 mt-2" id="hero-section">
        <div class="relative rounded-[24px] overflow-hidden shadow-sm border border-gray-100 bg-gray-50">
            <div id="hero-content" class="fade-in">
                <div class="relative">
                    <div class="absolute top-3 left-3 bg-[#FF005C] text-white text-[10px] font-black px-2 py-0.5 rounded italic uppercase tracking-tighter z-10 shadow-sm">YENƒ∞</div>
                    <img id="hero-img" src="" class="w-full h-52 object-cover">
                </div>
                
                <div class="p-4 flex items-center justify-between bg-white">
                    <div class="flex items-center gap-3">
                        <div id="hero-icon-container" class="w-12 h-12 bg-gray-50 rounded-xl flex items-center justify-center text-2xl shadow-inner border border-gray-100">
                            <span id="hero-icon"></span>
                        </div>
                        <div class="max-w-[160px]">
                            <h2 id="hero-title" class="font-bold text-lg leading-tight truncate"></h2>
                            <p id="hero-desc" class="text-gray-400 text-xs truncate"></p>
                        </div>
                    </div>
                    <button id="hero-btn" class="bg-[#00C2FF] text-white px-8 py-2.5 rounded-xl font-bold shadow-[0_4px_14px_rgba(0,194,255,0.39)] active:scale-95 transition-transform">Ba≈üla</button>
                </div>
            </div>
        </div>
        
        <div id="dots-container" class="flex justify-center gap-1.5 mt-4"></div>
    </section>

    <!-- Oyun Listeleri -->
    <section class="px-5 mt-10">
        <h3 class="text-xl font-bold mb-5 flex items-center gap-2">‚ú® Yeni Oyunlar</h3>
        <div id="new-games-list" class="space-y-6"></div>
    </section>

    <section class="px-5 mt-12 mb-10">
        <h3 class="text-xl font-bold mb-5 flex items-center gap-2">üî• Pop√ºler Oyunlar</h3>
        <div id="hot-games-list" class="space-y-6"></div>
    </section>

    <section class="px-5 mt-12 mb-10">
        <h3 class="text-xl font-bold mb-5 flex items-center gap-2">üß© Zeka & Strateji</h3>
        <div id="logic-games-list" class="space-y-6"></div>
    </section>

    <!-- ADMIN Gƒ∞Rƒ∞≈û MODAL -->
    <div id="admin-auth-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] hidden items-center justify-center p-6">
        <div class="bg-white rounded-[32px] p-8 w-full max-w-xs shadow-2xl">
            <h3 class="font-bold text-xl mb-2 text-center">Y√∂netici Giri≈üi</h3>
            <p class="text-gray-400 text-sm text-center mb-6">L√ºtfen y√∂netici kimliƒüinizi doƒürulayƒ±n.</p>
            <input type="password" id="admin-pass" placeholder="Admin ID" class="w-full bg-gray-50 border-none p-4 rounded-2xl mb-4 text-center font-bold focus:ring-2 focus:ring-[#00C2FF] transition-all">
            <button onclick="checkAdmin()" class="w-full bg-black text-white p-4 rounded-2xl font-bold shadow-lg active:scale-95 transition-transform">Giri≈ü Yap</button>
            <button onclick="toggleAdminAuth()" class="w-full text-gray-400 mt-4 text-sm font-medium">Vazge√ß</button>
        </div>
    </div>

    <!-- ADMIN PANEL -->
    <div id="admin-panel" class="fixed bottom-0 left-0 right-0 bg-[#121212] text-white p-6 z-[90] hidden-panel rounded-t-[40px] shadow-2xl overflow-y-auto max-h-[85vh] no-scrollbar">
        <div class="flex justify-between items-center mb-8">
            <div>
                <h2 class="text-2xl font-bold text-white">Y√∂netim Masasƒ±</h2>
                <p class="text-gray-500 text-xs">ƒ∞√ßerikleri anlƒ±k olarak g√ºncelle</p>
            </div>
            <button onclick="closeAdminPanel()" class="bg-gray-800 w-10 h-10 rounded-full flex items-center justify-center">
                <i class="fa-solid fa-chevron-down"></i>
            </button>
        </div>
        
        <div id="admin-game-editor" class="space-y-8"></div>

        <div class="sticky bottom-0 bg-[#121212] pt-4 pb-2 mt-6">
            <button onclick="saveAllChanges()" class="w-full bg-[#00C2FF] hover:bg-[#00b0e6] text-white font-black py-5 rounded-[24px] shadow-[0_10px_20px_rgba(0,194,255,0.2)] transition-all flex items-center justify-center gap-3">
                <i class="fa-solid fa-cloud-arrow-up"></i>
                DEƒûƒ∞≈ûƒ∞KLƒ∞KLERƒ∞ YAYINLA
            </button>
        </div>
    </div>

    <!-- Y√ºkleniyor G√∂stergesi -->
    <div id="loading-overlay" class="fixed inset-0 bg-white/80 backdrop-blur-md hidden items-center justify-center z-[110]">
        <div class="flex flex-col items-center">
            <div class="relative w-16 h-16">
                <div class="absolute inset-0 border-4 border-gray-100 rounded-full"></div>
                <div class="absolute inset-0 border-4 border-t-[#00C2FF] rounded-full animate-spin"></div>
            </div>
            <p class="mt-4 font-bold text-gray-600 italic">Senkronize ediliyor...</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'game-portal-v1';
        
        const MY_ADMIN_ID = "8392479231"; 

        let gamesData = { hero: [], others: [] };
        let currentHeroIndex = 0;
        let isAdmin = false;

        const getSettingsDocRef = () => doc(db, 'artifacts', appId, 'public', 'data', 'gameSettings', 'settings');

        async function init() {
            const initAuth = async () => {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            };
            
            await initAuth();

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    const docRef = getSettingsDocRef();
                    onSnapshot(docRef, (docSnap) => {
                        if (docSnap.exists()) {
                            gamesData = docSnap.data();
                            renderUI();
                        } else {
                            setupDefaultData();
                        }
                    }, (error) => {
                        console.error("Firestore Hatasƒ±:", error);
                    });
                }
            });
        }

        async function setupDefaultData() {
            const defaultData = {
                hero: [
                    { name: "S√ºper Yarƒ±≈ü", desc: "Hƒ±zƒ±n sƒ±nƒ±rlarƒ±nƒ± zorla!", icon: "üèéÔ∏è", img: "https://images.unsplash.com/photo-1511512578047-dfb367046420?w=800", link: "#" },
                    { name: "Uzay Yolu", desc: "Yƒ±ldƒ±zlar arasƒ± ke≈üif.", icon: "üöÄ", img: "https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=800", link: "#" },
                    { name: "Cyber Ninja", desc: "Geleceƒüin sava≈ü√ßƒ±sƒ± ol.", icon: "ü•∑", img: "https://images.unsplash.com/photo-1542751371-adc38448a05e?w=800", link: "#" }
                ],
                others: [
                    { name: "Maden Avcƒ±sƒ±", desc: "Altƒ±nlarƒ± topla, zengin ol!", icon: "üí∞", link: "#", category: "new" },
                    { name: "Hƒ±zlƒ± Penaltƒ±", desc: "≈ûampiyonluk gol√ºn√º at.", icon: "‚öΩ", link: "#", category: "new" },
                    { name: "Neon Ko≈üu", desc: "Engellerden ka√ß, rekor kƒ±r.", icon: "üèÉ", link: "#", category: "new" },
                    { name: "Meyve Bah√ßesi", desc: "Hasat zamanƒ± geldi.", icon: "üçé", link: "#", category: "hot" },
                    { name: "Sava≈ü Alanƒ±", desc: "Takƒ±mƒ±nƒ± zafere ta≈üƒ±.", icon: "üî´", link: "#", category: "hot" },
                    { name: "Drift Kralƒ±", desc: "Virajlarƒ± ustaca d√∂n.", icon: "üöó", link: "#", category: "hot" },
                    { name: "Blok Bulmaca", desc: "Zihnini zorlayan ≈üekiller.", icon: "üß±", link: "#", category: "logic" },
                    { name: "Sudoku Master", desc: "Sayƒ±larƒ±n d√ºnyasƒ±na gir.", icon: "üî¢", link: "#", category: "logic" }
                ]
            };
            try {
                await setDoc(getSettingsDocRef(), defaultData);
            } catch (err) {
                console.error("Yazma Hatasƒ±:", err);
            }
        }

        function renderUI() {
            renderHero();
            renderLists();
            if(isAdmin) renderAdminEditor();
        }

        function renderHero() {
            if(!gamesData.hero || !gamesData.hero.length) return;
            const game = gamesData.hero[currentHeroIndex];
            const content = document.getElementById('hero-content');
            if(!content) return;
            
            content.classList.remove('fade-in');
            void content.offsetWidth;
            content.classList.add('fade-in');

            document.getElementById('hero-img').src = game.img;
            document.getElementById('hero-icon').textContent = game.icon;
            document.getElementById('hero-title').textContent = game.name;
            document.getElementById('hero-desc').textContent = game.desc;
            document.getElementById('hero-btn').onclick = () => window.location.href = game.link;
            
            const dots = document.getElementById('dots-container');
            dots.innerHTML = gamesData.hero.map((_, i) => `<div class="w-1.5 h-1.5 rounded-full transition-all duration-300 ${i === currentHeroIndex ? 'bg-black w-3' : 'bg-gray-200'}"></div>`).join('');
        }

        function renderLists() {
            const newList = document.getElementById('new-games-list');
            const hotList = document.getElementById('hot-games-list');
            const logicList = document.getElementById('logic-games-list');
            
            if(!newList || !hotList || !logicList) return;
            
            newList.innerHTML = '';
            hotList.innerHTML = '';
            logicList.innerHTML = '';

            if(!gamesData.others) return;
            gamesData.others.forEach(game => {
                const html = `
                    <div class="flex items-center justify-between game-card transition-all">
                        <div class="flex items-center gap-4">
                            <div class="w-[58px] h-[58px] bg-gray-50 rounded-[18px] flex items-center justify-center text-[28px] shadow-sm border border-gray-100">${game.icon}</div>
                            <div class="max-w-[180px]">
                                <h4 class="font-bold text-[16px] leading-tight mb-0.5">${game.name}</h4>
                                <p class="text-gray-400 text-[12px] leading-snug line-clamp-2">${game.desc}</p>
                            </div>
                        </div>
                        <button onclick="window.location.href='${game.link}'" class="bg-[#00C2FF] text-white px-5 py-2 rounded-xl font-bold text-sm shadow-sm active:opacity-80">Oyna</button>
                    </div>`;
                
                if(game.category === 'new') newList.innerHTML += html;
                else if(game.category === 'hot') hotList.innerHTML += html;
                else if(game.category === 'logic') logicList.innerHTML += html;
            });
        }

        window.toggleAdminAuth = () => {
            const modal = document.getElementById('admin-auth-modal');
            modal.classList.toggle('hidden');
            modal.style.display = modal.classList.contains('hidden') ? 'none' : 'flex';
        };

        window.checkAdmin = () => {
            const pass = document.getElementById('admin-pass').value;
            if(pass === MY_ADMIN_ID) {
                isAdmin = true;
                document.getElementById('admin-auth-modal').classList.add('hidden');
                document.getElementById('admin-auth-modal').style.display = 'none';
                document.getElementById('admin-panel').classList.remove('hidden-panel');
                renderAdminEditor();
            } else {
                alert("Hatalƒ± Admin ID!");
            }
        };

        window.closeAdminPanel = () => document.getElementById('admin-panel').classList.add('hidden-panel');

        function renderAdminEditor() {
            const editor = document.getElementById('admin-game-editor');
            editor.innerHTML = '<h4 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4">Slider D√ºzenle</h4>';
            
            gamesData.hero.forEach((g, i) => {
                editor.innerHTML += createAdminInputGroup('hero', i, g);
            });

            editor.innerHTML += '<h4 class="text-xs font-bold text-gray-500 uppercase tracking-widest mt-10 mb-4">Liste D√ºzenle</h4>';
            gamesData.others.forEach((g, i) => {
                editor.innerHTML += createAdminInputGroup('others', i, g);
            });
        }

        function createAdminInputGroup(type, index, game) {
            const categories = type === 'others' ? `
                <select class="w-full bg-white/5 p-2 rounded-lg text-xs admin-field text-gray-400" data-type="${type}" data-idx="${index}" data-key="category">
                    <option value="new" ${game.category === 'new' ? 'selected' : ''}>Yeni</option>
                    <option value="hot" ${game.category === 'hot' ? 'selected' : ''}>Pop√ºler</option>
                    <option value="logic" ${game.category === 'logic' ? 'selected' : ''}>Zeka</option>
                </select>
            ` : '';

            return `
                <div class="bg-[#1E1E1E] p-4 rounded-[24px] space-y-3 border border-white/5 mb-4">
                    <div class="flex gap-2">
                        <input type="text" value="${game.icon}" class="w-12 bg-white/5 p-2 rounded-lg text-center admin-field" data-type="${type}" data-idx="${index}" data-key="icon">
                        <input type="text" value="${game.name}" class="flex-1 bg-white/5 p-2 rounded-lg admin-field font-bold" data-type="${type}" data-idx="${index}" data-key="name">
                    </div>
                    <input type="text" value="${game.desc}" class="w-full bg-white/5 p-2 rounded-lg text-xs admin-field" data-type="${type}" data-idx="${index}" data-key="desc">
                    <input type="text" value="${game.link}" class="w-full bg-white/5 p-2 rounded-lg text-xs admin-field text-blue-400" data-type="${type}" data-idx="${index}" data-key="link">
                    ${categories}
                    ${type === 'hero' ? `<input type="text" value="${game.img}" class="w-full bg-white/5 p-2 rounded-lg text-xs admin-field text-gray-400" data-type="${type}" data-idx="${index}" data-key="img">` : ''}
                </div>`;
        }

        window.saveAllChanges = async () => {
            if (!auth.currentUser) return;
            const loader = document.getElementById('loading-overlay');
            loader.style.display = 'flex';
            
            const fields = document.querySelectorAll('.admin-field');
            const newData = { hero: [...gamesData.hero], others: [...gamesData.others] };

            fields.forEach(f => {
                const { type, idx, key } = f.dataset;
                newData[type][idx][key] = f.value;
            });

            try {
                await setDoc(getSettingsDocRef(), newData);
                setTimeout(() => {
                    loader.style.display = 'none';
                    closeAdminPanel();
                }, 800);
            } catch (e) {
                alert("Kayƒ±t Hatasƒ±: " + e.message);
                loader.style.display = 'none';
            }
        };

        setInterval(() => {
            if(gamesData.hero && gamesData.hero.length > 0) {
                currentHeroIndex = (currentHeroIndex + 1) % gamesData.hero.length;
                renderHero();
            }
        }, 5000);

        init();
    </script>
</body>
</html>
