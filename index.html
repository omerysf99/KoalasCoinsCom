<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shorts Pro - Kesintisiz Deneyim</title>
    <style>
        body { margin: 0; padding: 0; background-color: #000; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Segoe UI', sans-serif; color: white; overflow: hidden; }
        
        /* Ana √áer√ßeve */
        .reels-wrapper { width: 100%; max-width: 400px; height: 100vh; position: relative; background: #000; overflow: hidden; }
        
        /* Kaydƒ±rma Alanƒ± */
        .reels-container { height: 100%; overflow-y: scroll; scroll-snap-type: y mandatory; scroll-behavior: smooth; }
        .reels-container::-webkit-scrollbar { display: none; }

        /* Video Kartƒ± */
        .video-card { height: 100vh; width: 100%; scroll-snap-align: start; scroll-snap-stop: always; position: relative; background: #000; display: flex; align-items: center; }
        
        /* YouTube Embed */
        iframe { width: 100%; height: 100%; pointer-events: none; transform: scale(1.4); }

        /* Tƒ±klama ve Etkile≈üim Katmanlarƒ± */
        .click-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; cursor: pointer; }
        
        /* Saƒü Men√º */
        .side-bar { position: absolute; right: 15px; bottom: 100px; z-index: 100; display: flex; flex-direction: column; gap: 20px; align-items: center; }
        .action-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: 0.2s; }
        .action-item:active { transform: scale(0.8); }
        .icon { font-size: 32px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8)); }
        .count { font-size: 12px; font-weight: bold; margin-top: 4px; text-shadow: 0 2px 4px black; }

        /* Kalp Animasyonu */
        .heart-pop { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); font-size: 120px; color: #ff0050; pointer-events: none; z-index: 150; }
        .animate-heart { animation: heartPop 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes heartPop { 
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.4); opacity: 1; }
            100% { transform: translate(-50%, -100%) scale(1.1); opacity: 0; }
        }

        /* Bilgi Alanƒ± */
        .video-info { position: absolute; bottom: 30px; left: 15px; z-index: 60; pointer-events: none; text-shadow: 0 2px 5px black; }
    </style>
</head>
<body>

<div class="reels-wrapper">
    <div id="heartPop" class="heart-pop">‚ù§Ô∏è</div>
    <div class="reels-container" id="reelsContainer"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
    // YouTube API Key ve Video Listesi
    const API_KEY = 'AIzaSyD1ie6u6qh7ef2dR64_ZICI2W20_FCs8LI';
    const videoData = [
        { id: 'znv__YAlrTQ', title: '√ñlene Kadar A≈üƒ±k ‚ú®' },
        { id: 'dj7QJ0-VIHc', title: '2024 T√ºrk√ße Pop Remix' },
        { id: 'lB6IgV1kapU', title: 'Yeni Hit ≈ûarkƒ± üî•' },
        { id: 'XHYVGwXC4Tc', title: 'M√ºzik Halleri' },
        { id: 'fkDpX8UXHN4', title: 'Manifest Dansƒ±' }
    ];

    const players = {};
    let clickTimer = null;

    function onYouTubeIframeAPIReady() {
        const container = document.getElementById('reelsContainer');
        
        videoData.forEach((v, index) => {
            const isLiked = localStorage.getItem(`like_${v.id}`) === 'true';
            const card = document.createElement('div');
            card.className = 'video-card';
            card.setAttribute('data-id', v.id);
            card.innerHTML = `
                <div class="click-layer" onclick="handleVideoTap('${v.id}', ${index})"></div>
                <div id="player-${v.id}"></div>
                <div class="side-bar">
                    <div class="action-item" onclick="event.stopPropagation(); toggleLike('${v.id}', ${index})">
                        <span class="icon like-icon">${isLiked ? '‚ù§Ô∏è' : 'ü§ç'}</span>
                        <span class="count like-count">${isLiked ? 1 : 0}</span>
                    </div>
                    <div class="action-item" onclick="event.stopPropagation(); addComment('${v.id}')">
                        <span class="icon">üí¨</span>
                        <span class="count">Yorum</span>
                    </div>
                    <div class="action-item"><span class="icon">üîñ</span><span class="count">Kaydet</span></div>
                </div>
                <div class="video-info">
                    <strong>@benim_sitem</strong>
                    <p>${v.title}</p>
                </div>
            `;
            container.appendChild(card);

            players[v.id] = new YT.Player(`player-${v.id}`, {
                videoId: v.id,
                playerVars: { 'autoplay': 0, 'controls': 0, 'loop': 1, 'playlist': v.id, 'mute': 1, 'modestbranding': 1, 'rel': 0 },
                events: { 'onReady': (e) => { if(index === 0) e.target.playVideo(); } }
            });
        });

        setupIntersectionObserver();
    }

    // √áAKI≈ûMAYI √ñNLEYEN VE AKI≈ûI Y√ñNETEN MEKANƒ∞ZMA
    function setupIntersectionObserver() {
        const options = { threshold: 0.8 }; // Video %80 g√∂r√ºn√ºr olunca tetiklenir
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const id = entry.target.getAttribute('data-id');
                if (entry.isIntersecting) {
                    // 1. √ñNCE Dƒ∞ƒûER T√úM Vƒ∞DEOLARI DURDUR (√áakƒ±≈üma √ñnleyici)
                    Object.values(players).forEach(p => { if(p.pauseVideo) p.pauseVideo(); });

                    // 2. AKTƒ∞F Vƒ∞DEOYU OYNAT VE SESƒ∞Nƒ∞ A√á
                    players[id].playVideo();
                    players[id].unMute();
                } else {
                    // Ekrandan √ßƒ±kanƒ±n sesini kƒ±s ve durdur
                    players[id].pauseVideo();
                    players[id].mute();
                }
            });
        }, options);

        document.querySelectorAll('.video-card').forEach(card => observer.observe(card));
    }

    function handleVideoTap(id, index) {
        if (!clickTimer) {
            clickTimer = setTimeout(() => {
                const state = players[id].getPlayerState();
                state === 1 ? players[id].pauseVideo() : players[id].playVideo();
                clickTimer = null;
            }, 250);
        } else {
            clearTimeout(clickTimer);
            clickTimer = null;
            toggleLike(id, index, true); // √áift tƒ±kla zorunlu beƒüeni
        }
    }

    function toggleLike(id, index, force = false) {
        const key = `like_${id}`;
        const isActive = localStorage.getItem(key) === 'true';
        const icon = document.querySelectorAll('.like-icon')[index];
        const count = document.querySelectorAll('.like-count')[index];

        if (!isActive) {
            localStorage.setItem(key, 'true');
            icon.innerText = '‚ù§Ô∏è';
            count.innerText = '1';
            playHeart();
        } else if (!force) {
            localStorage.removeItem(key);
            icon.innerText = 'ü§ç';
            count.innerText = '0';
        } else {
            playHeart();
        }
    }

    function addComment(id) {
        const comment = prompt("Sana √∂zel yorumun:");
        if(comment) localStorage.setItem(`comment_${id}`, comment);
    }

    function playHeart() {
        const h = document.getElementById('heartPop');
        h.classList.remove('animate-heart');
        void h.offsetWidth;
        h.classList.add('animate-heart');
    }
</script>
</body>
</html>
