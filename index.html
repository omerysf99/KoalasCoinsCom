<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Telegram Apps Center</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-secondary-bg-color: #f4f4f7;
        }

        body {
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .slider-container {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            gap: 12px;
            padding: 10px 0;
        }

        .slider-item {
            flex: 0 0 88%;
            scroll-snap-align: center;
            border-radius: 24px;
            overflow: hidden;
            position: relative;
            aspect-ratio: 16/9;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            background: #f8f8f8;
        }

        .game-card {
            transition: all 0.2s ease;
            background: transparent;
            border-radius: 20px;
        }

        .game-card:active {
            transform: scale(0.97);
            opacity: 0.8;
        }

        #admin-panel { 
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            transform: translateY(100%); 
        }
        #admin-panel.open { transform: translateY(0); }

        .category-pill {
            border-radius: 14px;
            padding: 10px 18px;
            font-weight: 700;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .badge-premium {
            background: #0088cc;
            color: #ffffff;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 6px;
            font-weight: 800;
        }

        .badge-choice {
            background: #fff9c4;
            color: #fbc02d;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 6px;
            font-weight: 800;
            display: inline-block;
            margin-top: 4px;
            border: 1px solid #fff176;
        }

        .btn-open {
            background: #f0f3f5;
            color: #0088cc;
            font-weight: 800;
            font-size: 13px;
            padding: 6px 18px;
            border-radius: 20px;
        }
    </style>
</head>
<body class="pb-24">

    <!-- Ana Uygulama Aray√ºz√º -->
    <div id="app-container" class="max-w-md mx-auto px-5 pt-4">
        
        <!-- √úst Ba≈ülƒ±k -->
        <header class="flex items-center justify-between mb-6">
            <h1 class="text-2xl font-black tracking-tight" id="welcome-msg">Merhaba! üëã</h1>
            <div class="flex gap-2">
                <button class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">üì¢</button>
                <button class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center font-bold text-xs">TR</button>
            </div>
        </header>

        <!-- √ñne √áƒ±kanlar Kaydƒ±rƒ±cƒ±sƒ± -->
        <div class="slider-container no-scrollbar mb-4" id="featured-slider">
            <!-- Oyunlar buraya dinamik eklenir -->
        </div>

        <!-- Kategori Butonlarƒ± -->
        <div class="flex gap-3 overflow-x-auto no-scrollbar py-2 mb-4">
            <button class="category-pill bg-pink-50 text-pink-600">üéÆ Games</button>
            <button class="category-pill bg-blue-50 text-blue-600">üè¶ Finance</button>
            <button class="category-pill bg-green-50 text-green-600">üîÑ Payments</button>
        </div>

        <!-- Trend Olanlar B√∂l√ºm√º -->
        <div class="mt-4">
            <div class="flex items-center justify-between mb-5">
                <h2 class="text-xl font-black">Trending This Week <span class="text-gray-300 font-light ml-1">‚Ä∫</span></h2>
            </div>
            <div id="trending-list" class="space-y-6">
                <!-- Trend listesi -->
            </div>
        </div>

        <!-- Yeni Uygulamalar B√∂l√ºm√º -->
        <div class="mt-10">
            <div class="flex items-center justify-between mb-5">
                <h2 class="text-xl font-black">New <span class="text-gray-300 font-light ml-1">‚Ä∫</span></h2>
            </div>
            <div id="new-list" class="space-y-6">
                <!-- Yeni listesi -->
            </div>
        </div>
    </div>

    <!-- Admin D√ºzenleme Butonu (Sadece Admin) -->
    <button id="admin-float-btn" class="hidden fixed bottom-6 right-6 w-14 h-14 bg-black text-white rounded-full shadow-2xl items-center justify-center z-50" onclick="toggleAdminPanel(true)">
        ‚öôÔ∏è
    </button>

    <!-- Admin Y√∂netim Paneli -->
    <div id="admin-panel" class="fixed inset-0 bg-white z-[100] flex flex-col">
        <div class="px-6 py-4 flex items-center justify-between border-b">
            <h2 class="text-lg font-black uppercase tracking-tight">Maƒüaza Y√∂netimi</h2>
            <button onclick="toggleAdminPanel(false)" class="text-2xl text-gray-400">‚úï</button>
        </div>

        <div class="flex-1 overflow-y-auto p-6 space-y-4">
            <div class="bg-gray-50 p-5 rounded-3xl border border-gray-100 space-y-4">
                <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Yeni Uygulama Ekle</p>
                <div class="flex gap-4">
                    <div class="w-20 h-20 bg-white border-2 border-dashed border-gray-200 rounded-2xl flex items-center justify-center cursor-pointer overflow-hidden" onclick="document.getElementById('icon-input').click()">
                        <img id="preview-img" class="hidden w-full h-full object-cover">
                        <span id="preview-label" class="text-[10px] text-gray-400 font-bold text-center">ƒ∞kon</span>
                    </div>
                    <input type="file" id="icon-input" class="hidden" accept="image/*" onchange="handleImage(this)">
                    <div class="flex-1 space-y-2">
                        <input type="text" id="game-name" placeholder="Uygulama Adƒ±" class="w-full p-3 bg-white border border-gray-100 rounded-xl text-sm outline-none">
                        <input type="text" id="game-desc" placeholder="Kƒ±sa A√ßƒ±klama" class="w-full p-3 bg-white border border-gray-100 rounded-xl text-sm outline-none">
                    </div>
                </div>
                <input type="text" id="game-link" placeholder="t.me/botlinki" class="w-full p-3 bg-white border border-gray-100 rounded-xl text-sm outline-none">
                <div class="flex gap-2">
                    <select id="game-type" class="flex-1 p-3 bg-white border border-gray-100 rounded-xl text-sm outline-none">
                        <option value="featured">√ñne √áƒ±kan (Slider)</option>
                        <option value="trending">Trend (Trending)</option>
                        <option value="new">Yeni (New)</option>
                    </select>
                    <button onclick="saveGame()" id="save-btn" class="px-8 bg-blue-500 text-white rounded-xl font-black text-sm">EKLE</button>
                </div>
                <div class="flex items-center gap-2">
                    <input type="checkbox" id="is-editors-choice" class="w-4 h-4">
                    <label for="is-editors-choice" class="text-xs font-bold text-gray-500">Edit√∂r√ºn Se√ßimi Rozeti</label>
                </div>
            </div>

            <div id="admin-list" class="space-y-3 pt-4">
                <!-- Mevcut uygulama listesi -->
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, doc, onSnapshot, addDoc, deleteDoc, serverTimestamp, getDocs, query, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'tg-store-white';
        const ADMIN_ID = "8392479231";

        let user = null;
        let allGames = [];
        let base64Icon = "";

        // Varsayƒ±lan Test Verileri
        const dummyData = [
            { name: "Dogs", desc: "Telegram'ƒ±n en yerel meme coin'i.", type: "trending", icon: "https://api.dicebear.com/7.x/identicon/svg?seed=dogs", link: "https://t.me/dogshouse_bot", editorsChoice: true },
            { name: "Getgems", desc: "TON √ºzerindeki en b√ºy√ºk NFT pazarƒ±.", type: "trending", icon: "https://api.dicebear.com/7.x/identicon/svg?seed=gems", link: "https://t.me/getgems", editorsChoice: false },
            { name: "8Bit", desc: "Klasik retro oyun deneyimi.", type: "new", icon: "https://api.dicebear.com/7.x/identicon/svg?seed=8bit", link: "https://t.me/bit_game_bot", editorsChoice: false },
            { name: "Duckygram", desc: "Eƒülen ve kazan!", type: "featured", icon: "https://api.dicebear.com/7.x/identicon/svg?seed=ducky", link: "https://t.me/duckygram_bot", editorsChoice: true }
        ];

        async function init() {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }

            onAuthStateChanged(auth, async (u) => {
                user = u;
                if (u) {
                    setupTelegram();
                    await seedInitialData();
                    listenGames();
                }
            });
        }

        async function seedInitialData() {
            const gamesRef = collection(db, 'artifacts', appId, 'public', 'data', 'games');
            const snap = await getDocs(query(gamesRef, limit(1)));
            if (snap.empty) {
                for (const g of dummyData) {
                    await addDoc(gamesRef, { ...g, created_at: serverTimestamp() });
                }
            }
        }

        function setupTelegram() {
            const tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand();
            tg.headerColor = "#ffffff";
            
            const tgUser = tg.initDataUnsafe?.user;
            if (tgUser) {
                document.getElementById('welcome-msg').innerText = `Merhaba! ${tgUser.first_name} üëã`;
                if (tgUser.id.toString() === ADMIN_ID) {
                    document.getElementById('admin-float-btn').classList.remove('hidden');
                    document.getElementById('admin-float-btn').classList.add('flex');
                }
            }
        }

        function listenGames() {
            const gamesRef = collection(db, 'artifacts', appId, 'public', 'data', 'games');
            onSnapshot(gamesRef, (snap) => {
                allGames = [];
                snap.forEach(d => allGames.push({ id: d.id, ...d.data() }));
                renderUI();
            });
        }

        function renderUI() {
            const slider = document.getElementById('featured-slider');
            const trendingList = document.getElementById('trending-list');
            const newList = document.getElementById('new-list');
            const adminInv = document.getElementById('admin-list');

            slider.innerHTML = "";
            trendingList.innerHTML = "";
            newList.innerHTML = "";
            adminInv.innerHTML = `<h3 class="text-[10px] font-black text-gray-400 uppercase mb-4 tracking-widest">Mevcut Envanter</h3>`;

            allGames.forEach(g => {
                if (g.type === 'featured') {
                    const slide = document.createElement('div');
                    slide.className = "slider-item";
                    slide.onclick = () => window.open(g.link, '_blank');
                    slide.innerHTML = `
                        <img src="${g.icon}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                        <div class="absolute bottom-5 left-5 right-5 flex items-end justify-between text-white">
                           <div class="flex-1">
                                <span class="badge-premium mb-2 inline-block">PREMIUM</span>
                                <h3 class="text-2xl font-black leading-tight">${g.name}</h3>
                                <p class="text-xs text-white/80 line-clamp-1">${g.desc}</p>
                           </div>
                           <button class="bg-white text-black px-5 py-2 rounded-xl text-xs font-black">A√ß</button>
                        </div>`;
                    slider.appendChild(slide);
                }

                const createRow = (data) => {
                    const div = document.createElement('div');
                    div.className = "game-card flex items-center justify-between";
                    div.onclick = () => window.open(data.link, '_blank');
                    div.innerHTML = `
                        <div class="flex items-center gap-4">
                            <img src="${data.icon}" class="w-16 h-16 rounded-2xl object-cover shadow-sm bg-gray-50 border border-gray-100">
                            <div>
                                <h4 class="font-black text-gray-900 leading-tight">${data.name}</h4>
                                ${data.editorsChoice ? '<span class="badge-choice">EDITORS\' CHOICE</span>' : ''}
                                <p class="text-[12px] text-gray-400 mt-1 line-clamp-1">${data.desc || ''}</p>
                            </div>
                        </div>
                        <button class="btn-open">A√ß</button>
                    `;
                    return div;
                };

                if (g.type === 'trending') trendingList.appendChild(createRow(g));
                if (g.type === 'new') newList.appendChild(createRow(g));

                const invItem = document.createElement('div');
                invItem.className = "flex items-center justify-between p-4 bg-gray-50 rounded-2xl border border-gray-100";
                invItem.innerHTML = `
                    <div class="flex items-center gap-3">
                        <img src="${g.icon}" class="w-8 h-8 rounded-lg">
                        <span class="text-sm font-bold text-gray-700">${g.name} <small class="text-gray-400">(${g.type})</small></span>
                    </div>
                    <button class="text-red-500 font-black text-xs px-3 py-1 bg-red-50 rounded-lg" onclick="deleteGame('${g.id}')">Sƒ∞L</button>`;
                adminInv.appendChild(invItem);
            });
        }

        window.handleImage = (input) => {
            if (input.files?.[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    base64Icon = e.target.result;
                    document.getElementById('preview-img').src = base64Icon;
                    document.getElementById('preview-img').classList.remove('hidden');
                    document.getElementById('preview-label').classList.add('hidden');
                };
                reader.readAsDataURL(input.files[0]);
            }
        };

        window.saveGame = async () => {
            const name = document.getElementById('game-name').value;
            const desc = document.getElementById('game-desc').value;
            const link = document.getElementById('game-link').value;
            const type = document.getElementById('game-type').value;
            const editorsChoice = document.getElementById('is-editors-choice').checked;

            if(!name || !link) return;

            try {
                const gamesRef = collection(db, 'artifacts', appId, 'public', 'data', 'games');
                await addDoc(gamesRef, {
                    name, desc, link, type, editorsChoice,
                    icon: base64Icon || `https://api.dicebear.com/7.x/identicon/svg?seed=${name}`,
                    created_at: serverTimestamp()
                });
                
                document.getElementById('game-name').value = "";
                document.getElementById('game-desc').value = "";
                document.getElementById('game-link').value = "";
                document.getElementById('is-editors-choice').checked = false;
                base64Icon = "";
                document.getElementById('preview-img').classList.add('hidden');
                document.getElementById('preview-label').classList.remove('hidden');
                toggleAdminPanel(false);
            } catch(e) { console.error(e); }
        };

        window.deleteGame = async (id) => {
            if(confirm('Silmek istediƒüinize emin misiniz?')) {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'games', id));
            }
        };

        window.toggleAdminPanel = (s) => document.getElementById('admin-panel').classList.toggle('open', s);

        window.addEventListener('load', init);
    </script>
</body>
</html>
