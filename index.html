<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Ultimate V7</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #0f0f0f; --text: white; --card-bg: #272727; --hover: #3f3f3f; --skeleton: #222; }
        body.light-mode { --bg: #ffffff; --text: #0f0f0f; --card-bg: #f2f2f2; --hover: #e5e5e5; --skeleton: #ddd; }

        * { box-sizing: border-box; margin: 0; padding: 0; transition: background 0.3s; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Roboto', sans-serif; overflow: hidden; }

        /* HEADER */
        header { height: 56px; padding: 0 16px; display: flex; align-items: center; justify-content: space-between; position: fixed; width: 100%; top: 0; background: var(--bg); z-index: 1000; }
        .search-box { display: flex; width: 40%; align-items: center; }
        .search-box input { width: 100%; background: var(--bg); border: 1px solid #333; padding: 8px 16px; border-radius: 20px 0 0 20px; color: var(--text); outline: none; }
        .search-box button { background: var(--card-bg); border: 1px solid #333; padding: 8px 15px; border-radius: 0 20px 20px 0; color: var(--text); cursor: pointer; }

        /* SKELETON ANIMATION */
        .skeleton { background: var(--skeleton); border-radius: 12px; position: relative; overflow: hidden; }
        .skeleton::after { content: ""; position: absolute; top: 0; right: 0; bottom: 0; left: 0; transform: translateX(-100%); background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent); animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 100% { transform: translateX(100%); } }

        /* SIDEBAR & CONTENT */
        .sidebar { position: fixed; left: 0; top: 56px; width: 240px; height: 100vh; background: var(--bg); padding: 12px; border-right: 1px solid var(--hover); }
        .main-wrapper { margin-left: 240px; margin-top: 56px; height: calc(100vh - 56px); overflow-y: auto; padding: 20px; scroll-behavior: smooth; }

        /* GRID DÜZENLERİ */
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
        .v-card { cursor: pointer; width: 100%; }
        .v-thumb { width: 100%; aspect-ratio: 16/9; border-radius: 12px; object-fit: cover; margin-bottom: 10px; }
        
        /* SHORTS */
        .shorts-section { margin: 30px 0; padding: 20px 0; border-top: 4px solid var(--hover); }
        .shorts-tray { display: flex; gap: 12px; overflow-x: auto; scrollbar-width: none; }
        .short-card { min-width: 180px; aspect-ratio: 9/16; border-radius: 12px; background: #000; overflow: hidden; position: relative; flex-shrink: 0; }
        .short-card iframe { width: 100%; height: 100%; border: none; pointer-events: none; transform: scale(1.5); }

        /* WATCH PAGE */
        #watch-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: none; overflow-y: auto; }
        .watch-content { max-width: 1300px; margin: 60px auto; display: grid; grid-template-columns: 2fr 1fr; gap: 24px; padding: 20px; }

        /* MINI PLAYER */
        #mini-player { position: fixed; bottom: 20px; right: 20px; width: 300px; aspect-ratio: 16/9; background: #000; border-radius: 12px; overflow: hidden; display: none; z-index: 3000; box-shadow: 0 10px 40px rgba(0,0,0,0.8); }

        @media (max-width: 1000px) { .sidebar { display: none; } .main-wrapper { margin-left: 0; } .watch-content { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<header>
    <div style="display:flex; align-items:center; gap:20px; cursor:pointer;" onclick="location.reload()">
        <i class="fas fa-bars"></i>
        <div style="font-size:20px; font-weight:bold;"><i class="fab fa-youtube" style="color:red"></i> YouTube</div>
    </div>
    <div class="search-box">
        <input type="text" id="search-input" placeholder="Ara..." onkeypress="if(event.key === 'Enter') performSearch()">
        <button onclick="performSearch()"><i class="fas fa-search"></i></button>
    </div>
    <div style="display:flex; gap:20px; align-items:center;">
        <i class="fas fa-sun" onclick="toggleTheme()" id="t-icon" style="cursor:pointer"></i>
        <i class="fas fa-video"></i>
        <div style="width:32px; height:32px; border-radius:50%; background:#444;"></div>
    </div>
</header>

<div class="sidebar">
    <div style="padding:10px; background:var(--card-bg); border-radius:10px;"><i class="fas fa-home"></i> Ana Sayfa</div>
    <div style="padding:10px;"><i class="fas fa-bolt"></i> Shorts</div>
    <div style="padding:10px;"><i class="fas fa-history"></i> Geçmiş</div>
</div>

<main class="main-wrapper" id="home-view" onscroll="handleInfiniteScroll()">
    <div class="video-grid" id="main-grid">
        <div class="v-card"><div class="v-thumb skeleton"></div><div class="skeleton" style="height:20px; width:80%"></div></div>
        <div class="v-card"><div class="v-thumb skeleton"></div><div class="skeleton" style="height:20px; width:70%"></div></div>
        <div class="v-card"><div class="v-thumb skeleton"></div><div class="skeleton" style="height:20px; width:90%"></div></div>
        <div class="v-card"><div class="v-thumb skeleton"></div><div class="skeleton" style="height:20px; width:60%"></div></div>
    </div>

    <div class="shorts-section">
        <h3>Shorts</h3>
        <div class="shorts-tray" id="shorts-tray"></div>
    </div>

    <div class="video-grid" id="secondary-grid"></div>
</main>

<div id="watch-overlay">
    <div style="padding:20px; cursor:pointer;" onclick="closeAndMini()"><i class="fas fa-chevron-down"></i> Kapat</div>
    <div class="watch-content">
        <div>
            <div id="player-area" style="width:100%; aspect-ratio:16/9; background:#000; border-radius:12px; overflow:hidden;"></div>
            <h2 id="w-title" style="margin-top:20px;"></h2>
            <div id="w-chan" style="color:#aaa; margin-top:10px;"></div>
        </div>
        <div id="w-recs"></div>
    </div>
</div>

<div id="mini-player">
    <i class="fas fa-times" onclick="document.getElementById('mini-player').style.display='none'" style="position:absolute; top:5px; right:5px; z-index:10; cursor:pointer; background:rgba(0,0,0,0.5); padding:5px; border-radius:50%;"></i>
    <div id="mini-content" style="width:100%; height:100%"></div>
</div>

<script>
    const API_KEY = 'AIzaSyDkaygARzpXfIXlozjyppLdXsPoE-mq1gg';
    let currentVideoId = '';
    let pageToken = '';

    // ÖZELLİK 1: AKILLI ARAMA
    async function performSearch() {
        const query = document.getElementById('search-input').value;
        if(!query) return;
        document.getElementById('main-grid').innerHTML = '';
        document.getElementById('secondary-grid').innerHTML = '';
        document.getElementById('shorts-tray').innerHTML = '';
        pageToken = '';
        loadVideos(query);
        loadShorts(query);
    }

    async function loadVideos(query = 'popüler türkçe') {
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=12&q=${query}&type=video&pageToken=${pageToken}&key=${API_KEY}`);
        const data = await res.json();
        pageToken = data.nextPageToken;
        const grid = document.getElementById('main-grid').innerHTML === '' ? 'main-grid' : 'secondary-grid';
        
        data.items.forEach(item => {
            document.getElementById(grid).innerHTML += `
                <div class="v-card" onclick="openVideo('${item.id.videoId}', '${item.snippet.title.replace(/'/g,"")}', '${item.snippet.channelTitle}')">
                    <img src="${item.snippet.thumbnails.high.url}" class="v-thumb">
                    <div style="font-weight:bold;">${item.snippet.title}</div>
                    <div style="color:#aaa; font-size:14px;">${item.snippet.channelTitle}</div>
                </div>`;
        });
        // Skeletonları temizle
        const skeletons = document.querySelectorAll('.skeleton');
        skeletons.forEach(s => s.parentElement.style.display = 'none');
    }

    async function loadShorts(query = 'shorts trend') {
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=8&q=${query}&type=video&videoDuration=short&key=${API_KEY}`);
        const data = await res.json();
        data.items.forEach(item => {
            document.getElementById('shorts-tray').innerHTML += `
                <div class="short-card" onclick="openVideo('${item.id.videoId}', 'Shorts', '${item.snippet.channelTitle}')">
                    <iframe src="https://www.youtube.com/embed/${item.id.videoId}?controls=0"></iframe>
                </div>`;
        });
    }

    function openVideo(id, title, channel) {
        currentVideoId = id;
        document.getElementById('mini-player').style.display = 'none';
        document.getElementById('watch-overlay').style.display = 'block';
        document.getElementById('player-area').innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${id}?autoplay=1" frameborder="0" allow="autoplay" allowfullscreen></iframe>`;
        document.getElementById('w-title').innerText = title;
        document.getElementById('w-chan').innerText = channel;
    }

    function closeAndMini() {
        document.getElementById('watch-overlay').style.display = 'none';
        document.getElementById('mini-player').style.display = 'block';
        document.getElementById('mini-content').innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${currentVideoId}?autoplay=1&controls=0" frameborder="0"></iframe>`;
        document.getElementById('player-area').innerHTML = '';
    }

    function toggleTheme() {
        document.body.classList.toggle('light-mode');
        document.getElementById('t-icon').classList.toggle('fa-moon');
    }

    function handleInfiniteScroll() {
        const el = document.getElementById('home-view');
        if (el.scrollTop + el.clientHeight >= el.scrollHeight - 100) {
            loadVideos(document.getElementById('search-input').value || 'trend');
        }
    }

    loadVideos();
    loadShorts();
</script>
</body>
</html>
