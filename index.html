<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram & TikTok Bot Kontrol Paneli</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f9; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { padding: 10px; margin-bottom: 20px; border-radius: 4px; }
        .online { background: #d4edda; color: #155724; }
        .log-area { background: #333; color: #fff; padding: 10px; height: 200px; overflow-y: scroll; font-size: 12px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Bot Durumu: <span id="statusText">Kapalı</span></h2>
    <p>Görseldeki TikTok bilgilerini ve Telegram Token'ınızı aşağıya girin:</p>
    
    <input type="text" id="tgToken" placeholder="Telegram Bot Token (BotFather'dan)" style="width: 100%; margin-bottom: 10px;">
    <input type="text" id="ttKey" value="aw01joj8wk4rnll9" style="width: 100%; margin-bottom: 10px;" placeholder="TikTok Client Key">
    <input type="text" id="ttSecret" value="U2i9FvupyDi5pUluq2Ce1KQSHiFRLG91" style="width: 100%; margin-bottom: 10px;" placeholder="TikTok Client Secret">
    
    <button onclick="startBot()" id="startBtn">Botu Başlat</button>

    <div style="margin-top: 20px;">
        <strong>İşlem Kayıtları:</strong>
        <div id="log" class="log-area"></div>
    </div>
</div>

<script>
    let lastUpdateId = 0;
    let isRunning = false;

    function log(msg) {
        const logDiv = document.getElementById('log');
        logDiv.innerHTML += `> ${new Date().toLocaleTimeString()}: ${msg}<br>`;
        logDiv.scrollTop = logDiv.scrollHeight;
    }

    async function startBot() {
        const token = document.getElementById('tgToken').value;
        if (!token) { alert("Lütfen Telegram Token girin!"); return; }
        
        isRunning = true;
        document.getElementById('statusText').innerText = "Çalışıyor...";
        document.getElementById('statusText').className = "online";
        log("Bot başlatıldı, mesajlar bekleniyor...");
        
        pollTelegram();
    }

    async function pollTelegram() {
        const token = document.getElementById('tgToken').value;
        if (!isRunning) return;

        try {
            const response = await fetch(`https://api.telegram.org/bot${token}/getUpdates?offset=${lastUpdateId + 1}`);
            const data = await response.json();

            if (data.result && data.result.length > 0) {
                for (let update of data.result) {
                    lastUpdateId = update.update_id;
                    handleMessage(update.message);
                }
            }
        } catch (error) {
            log("Hata: " + error.message);
        }

        setTimeout(pollTelegram, 3000); // 3 saniyede bir yeni mesaj kontrolü
    }

    async function handleMessage(msg) {
        if (!msg || !msg.text) return;
        
        const chatId = msg.chat.id;
        const text = msg.text;
        log(`Mesaj geldi: ${text}`);

        // Örnek: Eğer mesaj /tiktok ise TikTok API'sine bir istek simülasyonu yap
        if (text.startsWith("/tiktok")) {
            sendTelegramMessage(chatId, "TikTok verisi sorgulanıyor (API Key kullanılarak)...");
            
            // Burada TikTok API'sine istek atılabilir. 
            // TikTok API'leri genellikle OAuth gerektirir, bu basit örnekte mantığı gösteriyoruz:
            log("TikTok Client Key kullanılarak istek hazırlanıyor...");
            
            // Simülasyon cevabı
            setTimeout(() => {
                sendTelegramMessage(chatId, "TikTok Bağlantısı Başarılı! Key: " + document.getElementById('ttKey').value);
            }, 1000);
        } else {
            sendTelegramMessage(chatId, "Merhaba! TikTok bilgilerini sorgulamak için /tiktok yazabilirsin.");
        }
    }

    async function sendTelegramMessage(chatId, text) {
        const token = document.getElementById('tgToken').value;
        await fetch(`https://api.telegram.org/bot${token}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(text)}`);
    }
</script>

</body>
</html>
