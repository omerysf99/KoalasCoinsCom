<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shorts Pro - Ã‡akÄ±ÅŸma Fix</title>
    <style>
        /* TasarÄ±mÄ± ve KaydÄ±rma MekanizmasÄ±nÄ± DÃ¼zenle */
        body { margin: 0; padding: 0; background: #000; color: white; font-family: sans-serif; overflow: hidden; }
        
        .reels-wrapper { 
            width: 100%; max-width: 420px; height: 100vh; 
            margin: auto; position: relative; background: #000; 
        }

        .reels-container {
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory; /* VideolarÄ±n takÄ±lmadan hizalanmasÄ±nÄ± saÄŸlar */
            scrollbar-width: none;
        }
        .reels-container::-webkit-scrollbar { display: none; }

        .video-card {
            height: 100vh;
            width: 100%;
            scroll-snap-align: start;
            scroll-snap-stop: always;
            position: relative;
            overflow: hidden;
        }

        /* YouTube Videosunu Tam Ekran Yap ve Siyah BoÅŸluklarÄ± Kapat */
        iframe { 
            width: 100%; height: 100%; 
            pointer-events: none; 
            transform: scale(1.5); /* Videoyu bÃ¼yÃ¼tÃ¼p kenarlarÄ± kÄ±rpar (Shorts hissi) */
        }

        /* EtkileÅŸim KatmanlarÄ± */
        .click-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; cursor: pointer; }
        
        .side-bar { 
            position: absolute; right: 15px; bottom: 100px; 
            z-index: 100; display: flex; flex-direction: column; gap: 20px; 
        }

        .action-btn { 
            background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); 
            border-radius: 50%; width: 50px; height: 50px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 24px; border: 1px solid rgba(255,255,255,0.1);
        }

        .info-panel { position: absolute; bottom: 30px; left: 15px; z-index: 60; text-shadow: 0 2px 4px black; }
    </style>
</head>
<body>

<div class="reels-wrapper">
    <div class="reels-container" id="reelsContainer"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
    const API_KEY = 'AIzaSyD1ie6u6qh7ef2dR64_ZICI2W20_FCs8LI';
    const videoData = [
        { id: 'znv__YAlrTQ', title: 'Ã–lene Kadar AÅŸÄ±k âœ¨' },
        { id: 'dj7QJ0-VIHc', title: 'TÃ¼rkiye 2024 Hitleri' },
        { id: 'fkDpX8UXHN4', title: 'Manifest Dans Vibe ğŸ”¥' },
        { id: 'lB6IgV1kapU', title: 'Yeni Hit ÅarkÄ±' }
    ];

    const players = {};

    function onYouTubeIframeAPIReady() {
        const container = document.getElementById('reelsContainer');
        
        videoData.forEach((v, index) => {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.setAttribute('data-id', v.id);
            card.innerHTML = `
                <div class="click-layer" onclick="handleTap('${v.id}')"></div>
                <div id="player-${v.id}"></div>
                <div class="side-bar">
                    <div class="action-btn" onclick="event.stopPropagation(); alert('Sana Ã¶zel beÄŸenildi!')">â¤ï¸</div>
                    <div class="action-btn" onclick="event.stopPropagation(); prompt('Yorumun:')">ğŸ’¬</div>
                </div>
                <div class="info-panel">
                    <strong>@benim_sitem</strong>
                    <p>${v.title}</p>
                </div>
            `;
            container.appendChild(card);

            players[v.id] = new YT.Player(`player-${v.id}`, {
                videoId: v.id,
                playerVars: { 
                    'autoplay': 0, 'controls': 0, 'loop': 1, 'playlist': v.id, 
                    'mute': 1, 'modestbranding': 1, 'rel': 0 
                },
                events: { 'onReady': (e) => { if(index === 0) e.target.playVideo(); } }
            });
        });

        setupSafeObserver();
    }

    // Ã‡AKIÅMAYI Ã–NLEYEN GÃœVENLÄ° GÃ–ZLEMCÄ°
    function setupSafeObserver() {
        // threshold: 0.8 -> Videonun %80'i ekrana girmeden iÅŸlem yapmaz
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const id = entry.target.getAttribute('data-id');
                
                if (entry.isIntersecting) {
                    // 1. ADIM: DÄ°ÄER TÃœM VÄ°DEOLARI KESÄ°N OLARAK DURDUR
                    Object.keys(players).forEach(key => {
                        if (key !== id && players[key].pauseVideo) {
                            players[key].pauseVideo();
                        }
                    });

                    // 2. ADIM: SADECE AKTÄ°F VÄ°DEOYU OYNAT VE SESÄ°NÄ° AÃ‡
                    if (players[id] && players[id].playVideo) {
                        players[id].playVideo();
                        players[id].unMute();
                    }
                } else {
                    // Ekrandan Ã§Ä±kanÄ± durdur
                    if (players[id] && players[id].pauseVideo) {
                        players[id].pauseVideo();
                    }
                }
            });
        }, { threshold: 0.8 });

        document.querySelectorAll('.video-card').forEach(card => observer.observe(card));
    }

    function handleTap(id) {
        const state = players[id].getPlayerState();
        state === 1 ? players[id].pauseVideo() : players[id].playVideo();
    }
</script>
</body>
</html>
