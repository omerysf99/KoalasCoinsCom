<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>KOALA ARCADE | STABLE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Inter', sans-serif; user-select: none; }
        body { background-color: #000; color: #fff; overflow: hidden; height: 100vh; position: fixed; width: 100%; }

        /* UI Helpers */
        .glass { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); backdrop-filter: blur(15px); }
        .page { display: none; height: 100vh; overflow-y: auto; padding: 20px 20px 140px; }
        .page.active { display: block; animation: fadeIn 0.2s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Checking Screen */
        #checking-screen { position: fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:9999; display:flex; flex-direction:column; padding:40px 24px; justify-content:space-between; }
        .check-card { background:#09090b; border:1px solid #111; padding:20px; border-radius:24px; margin-bottom:12px; display:flex; align-items:center; justify-content:space-between; opacity:0; transform:translateY(10px); transition:0.4s; }
        .check-card.show { opacity:1; transform:translateY(0); }
        .dot { width:10px; height:10px; border-radius:50%; background:#222; }
        .dot.done { background:#fff; box-shadow:0 0 10px #fff; }

        /* Tap Mechanism */
        .tap-circle { width: 280px; height: 280px; margin: 20px auto; position: relative; display: flex; align-items: center; justify-content: center; }
        .tap-img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; border: 6px solid #111; transition: 0.1s cubic-bezier(0.1, 0.7, 1, 0.1); touch-action: manipulation; }
        .tap-img:active { transform: scale(0.92); border-color: #fff; }
        .tap-img.disabled { filter: grayscale(1); opacity: 0.2; pointer-events: none; }

        /* Floating Text */
        .f-text { position: absolute; color: white; font-weight: 900; font-size: 34px; pointer-events: none; animation: floatUp 0.6s ease-out forwards; z-index: 2000; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-130px); } }

        /* Navigation */
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; height: 95px; background: #050505; border-top: 1px solid #111; display: grid; grid-template-columns: repeat(4, 1fr); padding-bottom: 25px; z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: #444; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        .nav-item.active { color: #fff; }
        .nav-item i { font-size: 20px; margin-bottom: 4px; }

        .energy-bar { height: 10px; background: #0a0a0a; border-radius: 20px; overflow: hidden; border: 1px solid #151515; }
        #e-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #fff, #444); transition: 0.2s linear; }

        .btn-white { background:#fff; color:#000; padding:18px; border-radius:24px; font-weight:900; width:100%; text-transform:uppercase; transition:0.2s; border: none; outline: none; }
        .btn-white:active { transform:scale(0.97); opacity: 0.9; }

        #ad-view { position: fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:10000; display:none; flex-direction:column; align-items:center; justify-content:center; }
    </style>
</head>
<body>

    <div id="ad-view">
        <div class="text-center">
            <div class="w-16 h-16 border-2 border-white/10 border-t-white rounded-full animate-spin mx-auto mb-6"></div>
            <h2 id="ad-sec" class="text-8xl font-black">10</h2>
            <p class="text-zinc-600 font-bold text-[10px] mt-4 uppercase tracking-widest">Generating Power</p>
        </div>
    </div>

    <div id="checking-screen">
        <div class="text-center mt-6">
            <i class="fa-solid fa-bolt-lightning text-5xl mb-4 text-white"></i>
            <h1 class="text-3xl font-black italic tracking-tighter">INITIALIZING...</h1>
        </div>

        <div id="check-list">
            <div class="check-card" id="s1"><span>Syncing Data</span><div class="dot"></div></div>
            <div class="check-card" id="s2"><span>Energy Calibration</span><div class="dot"></div></div>
            <div class="check-card" id="s3"><span>Anti-Bot Shield</span><div class="dot"></div></div>
        </div>

        <div id="check-result" class="hidden text-center">
            <h2 id="veteran-years" class="text-8xl font-black tracking-tighter">0</h2>
            <p class="text-zinc-500 font-black uppercase italic">Years Veteran</p>
            <div class="mt-4 text-yellow-500 font-black text-2xl">+<span id="welcome-reward">0</span> $KOALA</div>
        </div>

        <div class="w-full">
            <button onclick="startCheck()" id="btn-check" class="btn-white">Check Eligibility</button>
            <button onclick="enterApp()" id="btn-claim" class="btn-white hidden">Claim & Start</button>
        </div>
    </div>

    <div id="main-app" class="hidden">
        
        <div id="p-earn" class="page active">
            <div class="text-center mt-6">
                <p class="text-zinc-600 font-black text-[10px] uppercase tracking-[0.4em] mb-1">Balance</p>
                <h1 id="bal-txt" class="text-6xl font-black tracking-tighter">0</h1>
            </div>

            <div class="tap-circle">
                <img src="coinkoala.jpg" id="koala-btn" class="tap-img" onclick="handleTap(event)">
            </div>

            <div class="max-w-[280px] mx-auto">
                <div class="flex justify-between items-center mb-2 px-1">
                    <span class="text-[10px] font-black text-zinc-500 uppercase">Energy</span>
                    <span class="text-[10px] font-black" id="e-txt">1000/1000</span>
                </div>
                <div class="energy-bar"><div id="e-fill"></div></div>
            </div>
        </div>

        <div id="p-tasks" class="page">
            <h2 class="text-3xl font-black italic mb-8 uppercase">Quests</h2>
            <div class="space-y-3">
                <div class="glass p-5 rounded-[24px] flex justify-between items-center" onclick="openTG()">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-blue-500/10 rounded-2xl flex items-center justify-center text-blue-400 text-xl"><i class="fa-brands fa-telegram"></i></div>
                        <div><p class="font-bold text-sm">Join Channel</p><p class="text-[10px] text-zinc-500">+50,000 $KOALA</p></div>
                    </div>
                    <i class="fa-solid fa-chevron-right text-zinc-800"></i>
                </div>
                <div class="glass p-5 rounded-[24px] flex justify-between items-center" onclick="triggerAd()">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-yellow-500/10 rounded-2xl flex items-center justify-center text-yellow-500 text-xl"><i class="fa-solid fa-play"></i></div>
                        <div><p class="font-bold text-sm">Watch Video</p><p class="text-[10px] text-zinc-500">+100 $KOALA</p></div>
                    </div>
                    <i class="fa-solid fa-chevron-right text-zinc-800"></i>
                </div>
            </div>
        </div>

        <div id="p-friends" class="page">
            <div class="text-center mt-10">
                <div class="w-20 h-20 bg-zinc-900 rounded-[2rem] mx-auto flex items-center justify-center mb-6 border border-zinc-800">
                    <i class="fa-solid fa-user-plus text-3xl"></i>
                </div>
                <h2 class="text-4xl font-black italic mb-2 tracking-tighter">FRIENDS</h2>
                <p class="text-zinc-500 text-sm px-10 mb-8 leading-relaxed">Invite friends and earn 10% from their mining power!</p>
                <div class="glass p-6 rounded-[30px] mb-8 overflow-hidden">
                    <p class="text-zinc-600 text-[10px] font-black uppercase mb-2">Invite Link</p>
                    <p id="ref-preview" class="text-[10px] font-mono text-zinc-400 truncate">t.me/KoalasUsdt_Bot?start=r...</p>
                </div>
                <button onclick="shareLink()" class="btn-white flex items-center justify-center gap-3">
                    <i class="fa-brands fa-telegram text-xl"></i> Share Link
                </button>
            </div>
        </div>

        <div id="p-drop" class="page">
            <h2 class="text-4xl font-black italic mb-8 uppercase text-center mt-4">Airdrop</h2>
            <div id="w-setup" class="glass p-8 rounded-[40px] text-center border-zinc-800">
                <p class="text-sm font-bold mb-8 text-zinc-400">Link your TON wallet for tokens.</p>
                <input type="text" id="w-input" class="w-full bg-black border border-zinc-900 p-5 rounded-2xl text-white font-bold text-xs mb-4 outline-none" placeholder="UQ... Wallet Address">
                <button onclick="saveW()" class="btn-white text-sm">Link Wallet</button>
            </div>
            <div id="w-done" class="hidden glass p-10 rounded-[40px] text-center">
                <i class="fa-solid fa-circle-check text-6xl text-white/20 mb-6"></i>
                <p id="w-preview" class="text-zinc-600 text-[10px] font-mono break-all"></p>
                <button onclick="resetW()" class="text-zinc-400 text-[10px] font-black uppercase underline mt-6">Change</button>
            </div>
        </div>

        <nav class="nav-bar">
            <div class="nav-item active" onclick="tab('earn', this)"><i class="fa-solid fa-hand-pointer"></i><span>Earn</span></div>
            <div class="nav-item" onclick="tab('tasks', this)"><i class="fa-solid fa-list-check"></i><span>Tasks</span></div>
            <div class="nav-item" onclick="tab('friends', this)"><i class="fa-solid fa-user-group"></i><span>Friends</span></div>
            <div class="nav-item" onclick="tab('drop', this)"><i class="fa-solid fa-parachute-box"></i><span>Airdrop</span></div>
        </nav>
    </div>

    <script>
        // --- DATA STATE ---
        let state = {
            bal: parseFloat(localStorage.getItem('k_bal')) || 0,
            energy: parseFloat(localStorage.getItem('k_energy')) || 1000,
            lastSync: parseInt(localStorage.getItem('k_sync')) || Date.now(),
            wallet: localStorage.getItem('k_wallet') || null,
            uid: localStorage.getItem('k_uid') || Math.floor(Math.random()*900000 + 100000),
            isClaimed: localStorage.getItem('k_clm') === 'true'
        };

        const MAX_E = 1000;
        const REFILL = MAX_E / 86400; 

        window.onload = () => {
            localStorage.setItem('k_uid', state.uid);
            document.getElementById('ref-preview').innerText = `t.me/KoalasUsdt_Bot?start=r${state.uid}`;
            syncEnergy();
            refreshUI();
            checkW();
            setInterval(autoRefill, 1000);
        };

        // --- STABLE SHARE SYSTEM ---
        function shareLink() {
            const link = `https://t.me/KoalasUsdt_Bot?start=r${state.uid}`;
            const msg = `ðŸ¨ Koala Arcade'e katÄ±l, tÄ±kla ve $KOALA kazan!\n\nðŸš€ GeleceÄŸin en bÃ¼yÃ¼k airdrop'unu kaÃ§Ä±rma!`;
            const shareUrl = `https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(msg)}`;
            
            // Kapanma sorununu Ã¶nlemek iÃ§in location.href kullanÄ±yoruz
            // Telegram browser bu linki algÄ±ladÄ±ÄŸÄ±nda dahili paylaÅŸÄ±m penceresini aÃ§ar
            window.location.href = shareUrl;
        }

        // --- CHECKING FLOW ---
        function startCheck() {
            document.getElementById('btn-check').classList.add('hidden');
            const steps = ['s1', 's2', 's3'];
            steps.forEach((id, i) => {
                setTimeout(() => {
                    const el = document.getElementById(id);
                    el.classList.add('show');
                    el.querySelector('.dot').classList.add('done');
                    if(i === 2) setTimeout(finishCheck, 600);
                }, i * 800);
            });
        }

        function finishCheck() {
            document.getElementById('check-list').classList.add('hidden');
            const years = Math.floor(Math.random()*4)+2;
            const rew = years * 12500;
            document.getElementById('veteran-years').innerText = years;
            document.getElementById('welcome-reward').innerText = rew.toLocaleString();
            document.getElementById('check-result').classList.remove('hidden');
            document.getElementById('btn-claim').classList.remove('hidden');
            if(!state.isClaimed) { state.bal += rew; state.isClaimed = true; localStorage.setItem('k_clm', 'true'); }
        }

        function enterApp() {
            document.getElementById('checking-screen').style.display = 'none';
            document.getElementById('main-app').classList.remove('hidden');
        }

        // --- CORE ENGINE ---
        function syncEnergy() {
            let now = Date.now();
            let elapsed = (now - state.lastSync) / 1000;
            state.energy = Math.min(MAX_E, state.energy + (elapsed * REFILL));
            state.lastSync = now;
        }

        function autoRefill() {
            if(state.energy < MAX_E) {
                state.energy = Math.min(MAX_E, state.energy + REFILL);
                refreshUI();
            }
        }

        function handleTap(e) {
            if(state.energy < 1) return;
            state.energy -= 1; state.bal += 1; state.lastSync = Date.now();
            createFloat(e.clientX, e.clientY);
            refreshUI();
        }

        function refreshUI() {
            document.getElementById('bal-txt').innerText = Math.floor(state.bal).toLocaleString();
            document.getElementById('e-txt').innerText = `${Math.floor(state.energy)}/${MAX_E}`;
            document.getElementById('e-fill').style.width = (state.energy/MAX_E*100) + "%";
            const btn = document.getElementById('koala-btn');
            if(state.energy < 1) btn.classList.add('disabled'); else btn.classList.remove('disabled');
            
            // Background Save
            localStorage.setItem('k_bal', state.bal);
            localStorage.setItem('k_energy', state.energy);
            localStorage.setItem('k_sync', state.lastSync);
        }

        function createFloat(x, y) {
            const d = document.createElement('div');
            d.className = 'f-text'; d.innerText = '+1';
            d.style.left = x + 'px'; d.style.top = y + 'px';
            document.body.appendChild(d);
            setTimeout(() => d.remove(), 600);
        }

        function tab(name, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('p-' + name).classList.add('active');
            el.classList.add('active');
        }

        function triggerAd() {
            const v = document.getElementById('ad-view');
            const s = document.getElementById('ad-sec');
            v.style.display = 'flex';
            let t = 10;
            const iv = setInterval(() => {
                t--; s.innerText = t;
                if(t<=0) { clearInterval(iv); v.style.display='none'; state.bal += 100; refreshUI(); }
            }, 1000);
        }

        function openTG() { window.location.href = 'https://t.me/KoalasCommunity'; }
        
        function saveW() {
            const val = document.getElementById('w-input').value;
            if(val.length < 8) return;
            state.wallet = val; localStorage.setItem('k_wallet', val); checkW();
        }
        function checkW() {
            if(state.wallet) {
                document.getElementById('w-setup').classList.add('hidden');
                document.getElementById('w-done').classList.remove('hidden');
                document.getElementById('w-preview').innerText = state.wallet;
            } else {
                document.getElementById('w-setup').classList.remove('hidden');
                document.getElementById('w-done').classList.add('hidden');
            }
        }
        function resetW() { state.wallet = null; localStorage.removeItem('k_wallet'); checkW(); }
    </script>
</body>
</html>
