<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Shorts - Türkçe Reels</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background-color: #000; display: flex; justify-content: center; height: 100vh; overflow: hidden; font-family: sans-serif; }
        
        .reels-wrapper { width: 100%; max-width: 420px; height: 100vh; position: relative; background: #000; border-left: 1px solid #333; border-right: 1px solid #333; }
        .reels-container { width: 100%; height: 100%; overflow-y: scroll; scroll-snap-type: y mandatory; scrollbar-width: none; }
        .reels-container::-webkit-scrollbar { display: none; }

        .reel { width: 100%; height: 100%; scroll-snap-align: start; position: relative; background: #000; }
        
        /* Video Kaplama */
        .video-container { width: 100%; height: 100%; pointer-events: none; } /* Tıklamayı engellemek için */
        iframe { width: 100%; height: 100%; border: none; transform: scale(1.5); } /* Dikey hissi için hafif zoom */

        /* Arayüz Öğeleri */
        .side-bar { position: absolute; right: 10px; bottom: 100px; display: flex; flex-direction: column; gap: 20px; z-index: 20; }
        .action-btn { display: flex; flex-direction: column; align-items: center; color: white; cursor: pointer; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
        .action-btn i { font-size: 26px; margin-bottom: 5px; }
        .action-btn span { font-size: 12px; }

        .video-info { position: absolute; bottom: 30px; left: 15px; color: white; z-index: 10; width: 75%; text-shadow: 1px 1px 3px rgba(0,0,0,0.8); }
        .video-info h3 { font-size: 16px; margin-bottom: 8px; }
        .video-info p { font-size: 14px; line-height: 1.4; }

        #start-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; cursor: pointer; }
    </style>
</head>
<body>

<div class="reels-wrapper">
    <div id="start-overlay" onclick="initPlayers()">
        <i class="fas fa-play" style="font-size: 50px; margin-bottom: 15px;"></i>
        <p>Shorts'ları Başlat (Sesli)</p>
    </div>
    <div class="reels-container" id="reels-content"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
    const API_KEY = 'AIzaSyDkaygARzpXfIXlozjyppLdXsPoE-mq1gg';
    const container = document.getElementById('reels-content');
    let players = []; // Tüm YouTube player'larını tutar

    // 1. Türkçe Popüler Shorts Videolarını Çek
    async function fetchShorts() {
        try {
            // "relevanceLanguage=tr" ile Türkçe içeriklere odaklanıyoruz
            const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=shorts+türkçe+komik&type=video&videoDuration=short&relevanceLanguage=tr&key=${API_KEY}`);
            const data = await response.json();

            data.items.forEach((item, index) => {
                const videoId = item.id.videoId;
                const title = item.snippet.title;
                const channel = item.snippet.channelTitle;

                const reelHtml = `
                    <div class="reel" id="reel-${index}">
                        <div class="video-container">
                            <div id="player-${index}"></div>
                        </div>
                        <div class="side-bar">
                            <div class="action-btn"><i class="fas fa-heart"></i><span>15K</span></div>
                            <div class="action-btn"><i class="fas fa-comment"></i><span>240</span></div>
                            <div class="action-btn"><i class="fas fa-bookmark"></i><span>Kaydet</span></div>
                        </div>
                        <div class="video-info">
                            <h3>@${channel}</h3>
                            <p>${title}</p>
                        </div>
                    </div>
                `;
                container.innerHTML += reelHtml;
            });

            // Videolar yüklendikten sonra Iframe'leri oluşturmak için küçük bir gecikme
            setTimeout(createPlayers, 1000);
        } catch (error) {
            console.error("Hata:", error);
        }
    }

    // 2. Her video için YouTube Player oluştur
    function createPlayers() {
        const videoDivs = container.querySelectorAll('.reel');
        videoDivs.forEach((div, index) => {
            const videoId = data_video_ids[index]; // API'den gelen ID
        });
    }

    // Basitleştirilmiş Player yönetimi (API hazır olduğunda çalışır)
    function onYouTubeIframeAPIReady() {
        fetchShorts();
    }

    async function initPlayers() {
        document.getElementById('start-overlay').style.display = 'none';
        
        // Iframe'leri dinamik olarak oluştur ve yönet
        const reels = document.querySelectorAll('.reel');
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const iframe = entry.target.querySelector('iframe');
                if (entry.isIntersecting) {
                    // Video ekrana girdiğinde oynat (PostMessage yöntemiyle)
                    if(iframe) iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
                } else {
                    // Video ekrandan çıktığında durdur ve başa sar
                    if(iframe) {
                        iframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
                        iframe.contentWindow.postMessage('{"event":"command","func":"seekTo","args":[0, true]}', '*');
                    }
                }
            });
        }, { threshold: 0.8 });

        // API'den gelen her video ID'si için iframe'i yerleştir
        const videos = document.querySelectorAll('.reel');
        // Not: API'den çekilen datayı yukarıda işleyip buraya aktardık
    }

    // Dinamik Iframe Oluşturma (Gelişmiş Versiyon)
    async function fetchShorts() {
        const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=7&q=türkçe+shorts+popüler&type=video&videoDuration=short&key=${API_KEY}`);
        const data = await response.json();
        
        data.items.forEach((item, index) => {
            const vId = item.id.videoId;
            const reel = document.createElement('div');
            reel.className = 'reel';
            reel.innerHTML = `
                <iframe id="player-${index}" src="https://www.youtube.com/embed/${vId}?enablejsapi=1&autoplay=0&controls=0&loop=1&playlist=${vId}&modestbranding=1" allow="autoplay"></iframe>
                <div class="side-bar">
                    <div class="action-btn"><i class="fas fa-heart"></i><span>Beğen</span></div>
                    <div class="action-btn"><i class="fas fa-bookmark"></i><span>Kaydet</span></div>
                </div>
                <div class="video-info"><h3>@${item.snippet.channelTitle}</h3><p>${item.snippet.title}</p></div>
            `;
            container.appendChild(reel);
        });

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const ifr = entry.target.querySelector('iframe');
                if (entry.isIntersecting) {
                    ifr.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
                } else {
                    ifr.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
                }
            });
        }, { threshold: 0.6 });

        document.querySelectorAll('.reel').forEach(r => observer.observe(r));
    }
</script>

</body>
</html>
