<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shorts Fix - Çakışma Önleyici</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        .reels-wrapper { width: 100%; max-width: 400px; height: 100vh; margin: auto; position: relative; }
        
        .reels-container {
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scrollbar-width: none;
        }
        .reels-container::-webkit-scrollbar { display: none; }

        .video-card {
            height: 100vh;
            width: 100%;
            scroll-snap-align: start;
            scroll-snap-stop: always;
            position: relative;
            background: #000;
        }
        iframe { width: 100%; height: 100%; pointer-events: none; transform: scale(1.3); }
        .click-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; }
    </style>
</head>
<body>

<div class="reels-wrapper">
    <div class="reels-container" id="reelsContainer"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
    const videoData = ['znv__YAlrTQ', 'dj7QJ0-VIHc', 'fkDpX8UXHN4', 'lB6IgV1kapU'];
    const players = {};

    function onYouTubeIframeAPIReady() {
        const container = document.getElementById('reelsContainer');
        
        videoData.forEach((id, index) => {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.setAttribute('data-v-id', id);
            card.innerHTML = `
                <div class="click-layer" onclick="handleTap('${id}')"></div>
                <div id="player-${id}"></div>
            `;
            container.appendChild(card);

            players[id] = new YT.Player(`player-${id}`, {
                videoId: id,
                playerVars: { 'autoplay': 0, 'controls': 0, 'loop': 1, 'playlist': id, 'mute': 1 },
                events: {
                    'onReady': (e) => { if(index === 0) e.target.playVideo(); }
                }
            });
        });

        // ÇAKIŞMA ÖNLEYİCİ MEKANİZMA
        const observerOptions = {
            root: container,
            threshold: 0.8 // Videonun %80'i görünmeden diğeri başlamaz
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const vId = entry.target.getAttribute('data-v-id');
                
                if (entry.isIntersecting) {
                    // 1. Önce oynayan tüm videoları durdur (En önemli kısım!)
                    Object.values(players).forEach(p => {
                        if (p && p.pauseVideo) p.pauseVideo();
                    });

                    // 2. Sadece ekrandakini oynat ve sesini aç
                    if (players[vId] && players[vId].playVideo) {
                        players[vId].playVideo();
                        players[vId].unMute();
                    }
                } else {
                    // Ekrandan çıkanı durdur
                    if (players[vId] && players[vId].pauseVideo) {
                        players[vId].pauseVideo();
                    }
                }
            });
        }, observerOptions);

        document.querySelectorAll('.video-card').forEach(card => observer.observe(card));
    }

    function handleTap(id) {
        const state = players[id].getPlayerState();
        state === 1 ? players[id].pauseVideo() : players[id].playVideo();
    }
</script>
</body>
</html>
